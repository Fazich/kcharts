KISSY.add("gallery/kcharts/1.1/piechart/index",function(r,B,F,G,H,I){function m(c,d){return c.toFixed(void 0==typeof d?d:2)}function w(c,d){return parseFloat(c.toFixed(4))}function E(c){z=(new I({themeCls:c.themeCls}))._colors;this.colorseed=0;this.container=r.get(c.renderTo);this.labelLayer=this.paper=B(r.get(this.container));this.textlabel=new G;this.cfg={};r.mix(this.cfg,J);r.mix(this.cfg,c);this.percentData=this.sectors=null;this.drawSector();this.renderTip()}var l=r.DOM,z,J={labelPadding:20};
r.extend(E,r.Base,{bindEvent:function(){for(var c=this.sectors,d=this,e=this.cfg.data,b=!1,f=null,g=0;g<c.length;g++)(function(a){c[a].mouseover(function(k){b=!0;f&&clearTimeout(f);d.fire("mouseenter",{sector:c[a],target:c[a],data:e[a],index:a})}).mouseout(function(k){b=!1;d.fire("mouseleave",{sector:c[a],target:c[a],data:e[a],index:a});f=setTimeout(function(){b||d.tip&&d.tip.hide()},500)}).click(function(k){d.fire("click",{sector:c[a],target:c[a],data:e[a],index:a})})})(g)},onend:function(){var c=
this.cfg,d=this;c.labelIndside?this.drawInsideLabel():!1!=c.label&&this.drawLabel();this.bindEvent();setTimeout(function(){d.fire("afterRender")},0)},sectorFull:function(c,d,e,b,f,g){var a=Math.PI/180;g=(b+f)/2;var k=c+e*Math.cos(-g*a),q=c+e*Math.cos(-b*a),n=c+e*Math.cos(-f*a),s=d+e*Math.sin(-g*a),u=d+e*Math.sin(-b*a),a=d+e*Math.sin(-f*a);c=["M",m(c),d,"L",m(q),m(u),"A",e,e,0,+(180<Math.abs(f-b)),1,m(n),m(a),"z"];b>f?(d=b,b=f):d=f;c.middle={from:d,to:b,angel:g,x:k,y:s};return c},sector:function(c,
d,e,b,f,g,a){var k=Math.PI/180;a=(f+g)/2;var q=c+e*Math.cos(-a*k),n=c+e*Math.cos(-f*k),s=c+e*Math.cos(-g*k),u=c+b*Math.cos(-f*k),K=c+b*Math.cos(-g*k);c=d+e*Math.sin(-a*k);var l=d+e*Math.sin(-f*k),r=d+e*Math.sin(-g*k),t=d+b*Math.sin(-f*k);d+=b*Math.sin(-g*k);e=["M",m(u),m(t),"L",m(n),m(l),"A",e,e,0,+(180<Math.abs(g-f)),1,m(s),m(r),"L",m(K),m(d),"A",b,b,0,+(180<Math.abs(g-f)),0,m(u),m(t)];f>g?(b=f,f=g):b=g;e.middle={from:b,to:f,angel:a,x:q,y:c};return e},drawSector:function(){function c(c){c=c.s;for(var h=
b.animater?c*u:u,f,g,p=0;p<C;p++)p?(f=g,g=f-360*c*a[p]):(k=90+360*(a[0]/2),q=90-360*(a[0]/2),f=k+c*(90-k),g=f+c*(q-k)),l=x?e.sector(n,s,h,x,f,g):e.sectorFull(n,s,h,f,g),1==a[p]&&(x?(l[12]=parseFloat(l[12])-0.1,l[l.length-2]=parseFloat(l[l.length-2])+0.1):l[l.length-3]=parseFloat(l[l.length-3])-0.1),m=l.join(" "),v[p]?v[p].attr("path",m):(f=d.path(m),v[p]=f,f=e.getcolor(p,w),v[p].attr({fill:f,stroke:"#fff"}),v[p].percent=a[p]),1===c&&(v[p].middle=l.middle)}var d=this.paper,e=this,b=this.cfg,f=b.data,
g=0,a=[],k,q,n=b.cx,s=b.cy,u=b.R,l,m,w=b.colors;this.percentData=a;for(var t=0;t<f.length;t++)var D=r.isNumber(f[t].data)?f[t].data:parseFloat(f[t].data),g=g+D;for(t=0;t<f.length;t++)a.push(f[t].data/g);var v=e.sectors=[],C=a.length,x=b.r,f={sector:c,r:function(c,f,b){f=c.s;c=f*u;var g,p;for(b=0;b<C;b++)b?(g=p,p=g-360*a[b]):(k=90+360*(a[0]/2),q=90-360*(a[0]/2),g=k+(90-k),p=g+(q-k)),l=e.sectorFull(n,s,c,g,p),m=l.join(" "),v[b]?v[b].attr("path",m):(g=d.path(m),v[b]=g,g=e.getcolor(b),v[b].attr({fill:g,
stroke:"#fff"}),v[b].percent=a[b]),1===f&&(v[b].middle=l.middle)}},g=r.mix({type:"sector"},b.anim),t=r.UA.ie&&8<r.UA.ie&&b.anim||!r.UA.ie&&b.anim,f=f[g.type]||c;t?(g=new F(g),g.on("step",f,this),g.on("end",this.onend,this),g.run()):(f({s:1,t:1}),this.onend())},scaleSector:function(c,d,e,b,f){c.scale(d,e,b,f)},transformSector:function(c,d){if(this.currentTransformedSector!=c){var e,b;d||(d=10);this.currentTransformedSector&&(b=this.currentTransformedSector.middle.angel*Math.PI/180,e=d*Math.cos(b),
b=-d*Math.sin(b),this.currentTransformedSector.translate(-e,-b));b=c.middle.angel*Math.PI/180;e=d*Math.cos(b);b=-d*Math.sin(b);c.animate({transform:"t"+e+","+b},400);this.currentTransformedSector=c}},getLabelXY:function(c,d,e,b){e=this.textlabel.getTextSize(e);c=b?c-e.width:c+5;d-=e.height/2;return{x:w(c),y:w(d)}},drawLabel:function(){for(var c=this.labelLayer,d=this.cfg,e=d.cx,b=d.cy,f=this.sectors,g,a,k=f.length,q=d.data,n=Math.PI/180,s=Math.cos,u=Math.sin,m=Math.asin,r,z,t,D,v,C=d.R,x=d.R+d.labelPadding,
B=d.R+2*d.labelPadding/3,h,A=[],y=[],p=0;p<k;p++)g=f[p],a=g.middle,h={},-90<=a.angel&&90>=a.angel?A.push(h):y.push(h),a=a.angel%360*n,r=w(e+C*s(-a)),z=w(b+C*u(-a)),t=w(e+B*s(-a)),D=w(b+B*u(-a)),v=w(e+x*s(-a)),a=w(b+x*u(-a)),h.i=p,h.x=r,h.y=z,h.x1=t,h.y1=D,h.x2=v,h.y2=a,g.label=h;f=y.length;g=0;Math.round(2*d.R/f);for(l.offset(this.container);f>g;)h=y[g],k=h.y2,a=(k-b)/x,a=1<a?1:-1>a?-1:a,a=Math.PI+m(a),n=w(e+x*s(a)),0<g&&!0!=q[h.i].hidelabel&&(a=y[g-1],a=a.y3,a-14<k&&(k=a-14)),n-=5,h.x3=n,h.y3=k,
u=["M",h.x,h.y,"Q",h.x2,h.y2," ",n,k],a=q[h.i].label,h.text=a,k=this.getLabelXY(n,k,a,!0),!0!=q[h.i].hidelabel&&(h=l.create('<span class="ks-charts-label"/>'),l.html(h,a),l.css(this.container,"position","relative"),l.css(h,{position:"absolute",left:k.x+"px",top:k.y+"px"}),l.append(h,this.container),h=c.path(u.join(",")),h.toBack(),d.labelline&&d.labelline.attr&&h.attr(d.labelline.attr)),g++;y=A.length;f=0;Math.round(2*d.R/y);for(A=A.slice(0);y>f;)h=A[f],k=h.y2,0<f&&!0!=q[h.i].hidelabel&&(a=A[f-1],
a.y3+14>k&&(k=a.y3+14)),a=(k-b)/x,a=1<a?1:-1>a?-1:a,a=m(a),n=w(e+x*s(a)),n+=5,h.x3=n,h.y3=k,u=["M",h.x,h.y,"Q",h.x2,h.y2," ",n,k,"L"],a=q[h.i].label,h.text=a,k=this.getLabelXY(n,k,a),!0!=q[h.i].hidelabel&&(h=l.create('<span class="ks-charts-label"/>'),l.html(h,a),l.css(this.container,"position","relative"),l.css(h,{position:"absolute",left:k.x+"px",top:k.y+"px"}),l.append(h,this.container),h=c.path(u.join(",")),h.toBack(),d.labelline&&d.labelline.attr&&h.attr(d.labelline.attr)),f++},drawInsideLabel:function(){for(var c=
this.cfg,d=c.data,e=this.sectors,b=c.cx,f=c.cy,c=c.R,g=0,a=e.length;g<a;g++){var k=d[g].label,q=e[g].middle.angel,n=Math.PI/180,s=b+0.5*c*Math.cos(-q*n),q=f+0.5*c*Math.sin(-q*n),n=this.textlabel.getTextSize(k),m=l.create('<span class="ks-charts-label"/>');l.text(m,k);s-=0.5*n.width;q-=0.5*n.height;l.css(this.container,"position","relative");l.css(m,{position:"absolute",left:s+"px",top:q+"px"});l.append(m,this.container)}},renderTip:function(){var c=this.cfg.tip,d=this.container,e,b,f,g;c&&c.tpl&&
(e=l.offset(d),b=l.outerWidth(d),f=l.outerHeight(d),e=c.boundryDetect?{x:e.left,y:e.top,width:b,height:f}:{},r.mix(c,{rootNode:r.all(d),boundry:e,autoRender:1}),this.tip=new H(c),g=this.tip.getInstance(),this.on("mouseenter",function(a){var b=a.sector,d=b.middle,f=d.x,d=d.y,e=B.getRGB(b.attr("fill")),m={};r.mix(m,a.data);m.percent=b.percent;b=e.hex;e=parseInt(b.substring(1,3),16);a=parseInt(b.substring(3,5),16);b=parseInt(b.substring(5,7),16);e=parseInt(80*e/100);a=parseInt(80*a/100);b=parseInt(80*
b/100);e=255>e?e:255;a=255>a?a:255;b=255>b?b:255;e=1==e.toString(16).length?"0"+e.toString(16):e.toString(16);a=1==a.toString(16).length?"0"+a.toString(16):a.toString(16);b=1==b.toString(16).length?"0"+b.toString(16):b.toString(16);e="#"+e+a+b;this.tip.renderTemplate(c.tpl,m);l.css(g,{borderColor:e});this.tip.fire("move",{x:f,y:d})},this))},getcolor:function(c,d){var e=d||z;c%=e.length;return d&&d[c]?e[c].DEFAULT:z[c].DEFAULT}});return E},{requires:["gallery/kcharts/1.1/raphael/index","gallery/kcharts/1.1/ft/index",
"gallery/kcharts/1.1/label/index","gallery/kcharts/1.1/tip/index","../tools/color/index"]});
