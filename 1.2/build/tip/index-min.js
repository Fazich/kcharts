/*! kcharts - v1.2 - 2013-08-07 12:47:35 PM
* Copyright (c) 2013 数据可视化小组; Licensed  */
KISSY.add("gallery/kcharts/1.2/tip/index",function(l,t,e,r){function i(t){if(t){var e=this,i={clsName:"ks-chart-default",autoRender:!0,isVisable:!1,boundry:{x:0,y:0,width:0,height:0},rootNode:n("body"),tpl:"",corner:{isShow:!1,tpl:"corner",css:{position:"absolute",marginLeft:0,marginTop:0}},anim:{easing:"easeOut",duration:.25},offset:{x:0,y:0},alignX:"left",alignY:"top"};e._events={MOVE:"move",SETCONT:"setcontent",HIDE:"hide"},e._cfg=l.mix(i,t,r,r,!0),e._cfg.rootNode=n(e._cfg.rootNode),e.init()}}var n=l.all;return l.Event,l.augment(i,t,{init:function(){var l=this,t=l._cfg;l._data={},l._tpl=t.tpl,l.$tip,l.bindEvent(),t.autoRender&&l.render()},bindEvent:function(){var t=this,e=t._cfg.template,r=t._events;t.on(r.MOVE,function(l){var e=l.x,r=l.y,i=l.style;t.isVisable()&&t._cfg.anim?t.animateTo(e,r):t.moveTo(e,r),i&&t.$tip.css(i)}),t.on(r.SETCONT,function(r){l.isFunction(e)?t.setContent(e(r.data)):t.renderTemplate(e,r.data)}),t.on(r.HIDE,function(){t.hide()})},getInstance:function(){return this.$tip},isVisable:function(){return"none"==this.$tip.css("display")?!1:!0},show:function(){var l=this;return l.$tip&&l.$tip.show(),l},hide:function(){var l=this;return l.$tip&&l.$tip.stop()&&l.$tip.hide(),l},moveTo:function(l,t){var e=this;e._prevtime=(new Date).getTime(),e.show();var r=e.getInstance(),i=e._cfg,n=(e._cfg.anim,e.getPos(l,t)),s=(i.corner.css["margin-top"]||i.corner.css.marginTop||0,i.corner.css["margin-left"]||i.corner.css.marginLeft||0),a=e.$corner;a&&a.css({"margin-left":s+l-n.x}),r.css({"margin-top":n.y,"margin-left":n.x})},animateTo:function(l,t,e){var r=this,i=r._cfg,n=i.anim,s=(new Date).getTime();r._prevtime&&100>s-r._prevtime&&r.animateFast(l,t,e),r.show(),r._prevtime=(new Date).getTime();var a=r.getInstance(),o=r.getPos(l,t),c=(i.corner.css["margin-top"]||i.corner.css.marginTop||0,i.corner.css["margin-left"]||i.corner.css.marginLeft||0),h=r.$corner;h&&h.css({"margin-left":c+l-o.x}),a.stop().animate({"margin-top":o.y,"margin-left":o.x},n.duration,n.easing,function(){e&&e()})},animateFast:function(l,t,e){var i,n,s=this,a=s.get("x"),o=s.get("y"),c=.2;s._prevtime=(new Date).getTime(),s.show(),a!==r&&(i=a/1+(l-a)*c,n=o/1+(t-o)*c);var h=s.getInstance(),f=s._cfg,d=s._cfg.anim,u=s.getPos(i,n),p=(f.corner.css["margin-top"]||f.corner.css.marginTop||0,f.corner.css["margin-left"]||f.corner.css.marginLeft||0),g=s.$corner;g&&g.css({"margin-left":p+l-u.x}),h.css({"margin-top":u.y,"margin-left":u.x});var x=s.getPos(l,t);h.stop().animate({"margin-top":x.y,"margin-left":x.x},d.duration,d.easing,function(){e&&e()})},renderTemplate:function(l,t){return this.setContent(e(l).render(t))},setContent:function(l){return n("."+this._cfg.clsName+"-tip-content",this.$tip).html(l)},getPos:function(l,t){var e=this,r=e._cfg,i=r.offset,n=t+i.y,s=l+i.x,a=r.alignX,o=r.alignY,c=e.getInstance(),h=c.outerWidth(),f=c.outerHeight(),d=r.boundry;switch(e.set("x",l||0),e.set("y",t||0),a){case"center":s=Math.round(l)+i.x-h/2;break;case"right":s=Math.round(l)+i.x-h}switch(o){case"middle":n=Math.round(t)+i.y-f/2;break;case"bottom":n=Math.round(t)+i.y-f}if(d.width&&d.height){var u=d.x||0,p=d.y||0,g=d.width,x=d.height;p>n?n=t- -Math.abs(i.y):n>p+x-f&&(n=t-f-Math.abs(i.y)),u>s?s=l- -Math.abs(i.x):s>u+g-h&&(s=l-h-Math.abs(i.x))}return{x:s,y:n}},_isExist:function(){return this.$tip&&this.$tip[0]},render:function(){var l=this,t=l._cfg,e=l._tpl,i=l._data,s=t.isVisable?"inline-block":"none",a=t.rootNode.offset();if(t.rootNode.offset())return l.$tip=!l._isExist()&&n('<span class="'+t.clsName+'-tip" style="*zoom:1;"><span class="'+t.clsName+'-tip-content"></span></span>').css({display:s}).appendTo(t.rootNode),l.$corner=t.corner.isShow&&t.corner.tpl?n("<div class='"+t.clsName+"-corner'>"+t.corner.tpl+"</div>").css(t.corner.css).appendTo(l.$tip):r,l.$tip.css({"margin-top":a.top+t.offset.y,"margin-left":a.left+t.offset.x,position:"absolute"}),l.renderTemplate(e,i),l.$tip}}),l.KCharts&&l.KCharts.Tip||l.namespace("KISSY.KCharts"),l.KCharts.Tip=i,i},{requires:["base","gallery/template/1.0/index","./assets/tip.css"]});