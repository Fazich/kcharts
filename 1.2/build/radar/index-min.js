/*! kcharts - v1.2 - 2013-11-22 2:11:45 PM
* Copyright (c) 2013 数据可视化小组; Licensed  */
KISSY.add("gallery/kcharts/1.2/radar/xxyy",function(){function l(){for(this.epsilon=1;1!==1+this.epsilon/2;)this.epsilon/=2;return this}return l.prototype.ONE_OVER_LOG_10=1/Math.log(10),l.prototype.extended=function(l,e,t,i,n,r){var s,a,x,y,o,c,h,v,f,d,p,g,u,_,m,b,w,k,L,C,S,A,M,T,E,I,P,Y,z,N,R,G,X;if(null==i&&(i=!1),null==n&&(n=[1,5,2,2.5,4,3]),null==r&&(r={simplicity:.2,coverage:.25,density:.5,legibility:.05}),T=function(l,e,t,i){return r.simplicity*l+r.coverage*e+r.density*t+r.legibility*i},a=0,s=0,x=0,y=-2,f=this.epsilon,G=l>e?[e,l]:[l,e],L=G[0],w=G[1],f>e-l)return[L,w,t,-2];for(_=n.length,p=-1;Number.POSITIVE_INFINITY>p;){for(A=N=0,X=_-1;X>=0?X>=N:N>=X;A=X>=0?++N:--N)if(S=n[A],E=this.simplicityMax(A,_,p),y>T(E,1,1,1))p=Number.POSITIVE_INFINITY;else for(g=2;Number.POSITIVE_INFINITY>g;){if(v=this.densityMax(g,t),y>T(E,1,v,1))g=Number.POSITIVE_INFINITY;else for(h=(w-L)/(g+1)/p/S,z=Math.ceil(Math.log(h)*this.ONE_OVER_LOG_10);Number.POSITIVE_INFINITY>z;)if(P=p*S*Math.pow(10,z),c=this.coverageMax(L,w,P*(g-1)),y>T(E,c,v,1))z=Number.POSITIVE_INFINITY;else{if(C=Math.floor(w/P)*p-(g-1)*p,k=Math.ceil(L/P)*p,C>k);else for(I=R=C;k>=C?k>=R:R>=k;I=k>=C?++R:--R)b=I*(P/p),m=b+P*(g-1),(!i||L>=b&&m>=w)&&(M=this.simplicity(A,_,p,b,m,P),o=this.coverage(L,w,b,m),d=this.density(g,t,L,w,b,m),u=this.legibility(b,m,P),Y=T(M,o,d,u),Y>y&&(y=Y,a=b,s=m,x=P));z+=1}g+=1}p+=1}return[a,s,x,y]},l.prototype.simplicity=function(l,e,t,i,n,r){var s;return s=(this.epsilon>i%r||this.epsilon>r-i%r)&&0>=i&&n>=0?1:0,1-l/(e-1)-t+s},l.prototype.simplicityMax=function(l,e,t){return 1-l/(e-1)-t+1},l.prototype.coverage=function(l,e,t,i){var n;return n=e-l,1-.5*(Math.pow(e-i,2)+Math.pow(l-t,2))/Math.pow(.1*n,2)},l.prototype.coverageMax=function(l,e,t){var i,n;return n=e-l,t>n?(i=(t-n)/2,1-.5*(Math.pow(i,2)+Math.pow(i,2))/Math.pow(.1*n,2)):1},l.prototype.density=function(l,e,t,i,n,r){var s,a;return s=(l-1)/(r-n),a=(e-1)/(Math.max(r,i)-Math.min(t,n)),2-Math.max(s/a,a/s)},l.prototype.densityMax=function(l,e){return l>=e?2-(l-1)/(e-1):1},l.prototype.legibility=function(){return 1},l}),KISSY.add("gallery/kcharts/1.2/radar/index",function(l,e,t,i,n,r){function s(l,e,t){return l+(e-l)*t}function a(l,e,i){c||(c=new t);for(var n=c.extended(l,e,i),r=[],s=n[0],a=n[1],x=n[2],y=(a-s)/x,o=1;y>=o;o++)r.push(a),a-=x;return r=r.reverse(),{rullers:r,rullern:y}}function x(l){for(var e,t=0,i=l.length;i>t;t++){var n=l[t],r=n.x,s=n.y;t?e.push("L",r,s):e=["M",r,s]}return e.push("Z"),e.join(",")}function y(l,e){var t;t=e?"show":"hide",h(l,function(l){l[t]()})}function o(t){var i=l.get(t.renderTo);t.anim=l.merge(p,t.anim),this.set("container",i),this.set(t),this._animationInstance=0,this.dochk(t);var n;if(!i)throw Error("容器不能为空");n=e(i,t.width,t.height),this.set("paper",n),this.set("config",t),this.render(t)}Math.PI;var c,h=l.each,v=(l.map,l.filter,l.merge),f={text:{fill:"#222","max-chars":10,key:!0}},d={points:{fill:"#333","stroke-width":"0",size:4.5},text:{fill:"#222","text-anchor":"start"},lines:{"stroke-width":"1"}},p={easing:"linear",duration:800};return l.extend(o,l.Base,{dochk:function(l){var e=l.labels.length,t=i.width(this.get("container")),n=i.height(this.get("container"));this.set("sides",e),void 0==l.cx&&(l.cx=t/2),void 0==l.cy&&(l.cy=n/2);var r=this.get("scoreGroups"),s=[];r[0]&&r[0].scores&&h(r,function(l){s=s.concat(l.scores)});var a=Math.max.apply(Math,s);if(Math.min.apply(Math,s),l.min=0,(!l.max||a>l.max)&&(l.max=a),void 0==l.r){var x=Math.min.apply(Math,[t,n]);l.r=x/2-30,0>l.r&&(l.r=x/2)}},drawPolygon:function(l){var e=this.get("paper"),t=x(l);return e.path(t)},drawFrame:function(l){var e=this.drawPolygon(l).attr({stroke:"#777"});this.set("framepath",e)},getOption:function(){var l=this.get("config"),e={text:{fill:"#222","max-chars":10,key:!0}};l.options;var t=v(e,l.options);return t},getGroupOption:function(e){var t={points:{fill:"#333","stroke-width":"0",size:4.5},text:{fill:"#222","text-anchor":"start"},lines:{"stroke-width":"1"}};return l.merge(t,e)},drawGroup:function(l,e,t){for(var i,n,r,a,x=this.get("config"),y=x.cx,o=x.cy,c=this.get("paper"),h=this.get("lines")||[],v=[],f=this.get("pts")||[],d=[],p=0;e.length>p;p++)i=s(y,e[p].x,l[p]),n=s(o,e[p].y,l[p]),d.push({x:i,y:n});r=this.drawPolygon(d),t&&t.lines&&r.attr(t.lines);for(var g=0;l.length>g;g++)i=s(y,e[g].x,l[g]),n=s(o,e[g].y,l[g]),a=c.circle(i,n,t.points.size).attr(t.points),v.push(a);f.push(v),h.push(r),this.get("lines")||(this.set("lines",h),this.set("pts",f))},getPoints:function(){for(var l,e,t=this.get("sides"),i=this.get("config"),n=-90,r=i.r,s=i.cx,a=i.cy,x=[],y=360/t,o=0;t>o;o++){var c=n/360*2*Math.PI;l=s+r*Math.cos(c),e=a+r*Math.sin(c),x.push({x:l,y:e}),n+=y}return x},getBBox:function(){var l=this.get("r"),e=2*l,t=2*l,i=this.get("cx"),n=this.get("cy");return{width:e,height:t,left:i-e/2,top:n-t/2}},drawLegend:function(l){var e=this.get("container"),t=this.getBBox(),i=this.get("legend")||{},n=v({interval:20,iconright:5,showicon:!0},i.globalConfig);delete i.globalConfig;var s=new r(v({container:e,paper:this.get("paper"),bbox:t,align:i.align||"bc",offset:i.offset||[0,20],globalConfig:n,config:l},i));s.on("click",function(l){if(!this.isRunning()){var e=l.index,t=(l.text,l.icon,l.el);1!=t.hide?(this.hideLine(e),t.hide=1,t.disable()):(this.showLine(e),t.hide=0,t.enable())}},this),this.set("legend",s)},hideLine:function(l){var e=this.get("lines"),t=this.get("pts");e[l]&&y([e[l]]),t[l]&&y(t[l])},showLine:function(l){var e=this.get("lines"),t=this.get("pts");e[l]&&y([e[l]],!0),t[l]&&y(t[l],!0)},drawLabels:function(e,t){for(var i,n,r=e,a=this,x=this.get("paper"),y=this.get("config"),o=y.cx,c=y.cy,h=(y.r,y.labels),v=0;r.length>v;v++){i=s(o,r[v].x,1.1),n=s(c,r[v].y,1.1);var f="middle";i>o&&(f="start"),o>i&&(f="end");var d=h[v];d.length>t.text["max-chars"]&&(d=d.replace(" ","\n"));var p=x.text(i,n,d).attr(l.merge(t.text,{"text-anchor":f,cursor:"pointer"}));(function(l,e,t){l.click(function(){a.fire("labelclick",{index:e,x:t.x,y:t.y})}).mouseover(function(){a.fire("labelmouseover",{index:e,x:t.x,y:t.y})}).mouseout(function(){a.fire("labelmouseout",{index:e,x:t.x,y:t.y})})})(p,v,r[v])}},drawMeasureAndRuler:function(e){var t,i,n,r,x,y,o=this.get("paper"),c=this.get("config"),h=c.cx,v=c.cy,f=[],d=Math.PI/180,p=e.length,g=360/p,u=!1;c.labelfn&&l.isFunction(c.labelfn)&&(u=c.labelfn);var _=c.ruller&&c.ruller.n||5,m=a(c.min,c.max,_),b=m.rullers;_=m.rullern;for(var w=1/_,k=0;p>k;k++){t=e[k].x,i=e[k].y,f.push(o.path("M "+h+" "+v+" L "+t+" "+i).attr("stroke","#777"));for(var L=180-k*g,C=Math.cos(L*d),S=Math.sin(L*d),A=1;_>A;A++){var M=s(h,e[k].x,A*w),T=s(v,e[k].y,A*w);n=M+3*C,r=T-3*S,x=M-3*C,y=T+3*S;var E,I;E=M-5*C,I=T+5*S,o.path(["M",x,y,"L",n,r,"Z"]);var P=k*g;if(P>=270?P+=90:P>=90&&(P+=180),u&&u(k)){var Y;c.ruller&&c.ruller.template&&(Y=c.ruller.template(k,A,b[A-1])),o.text(E,I,Y).attr({"text-anchor":"start"}).rotate(P)}}}},getScoreFromGroup:function(l){var e=[],t=this.get("config"),i=t.max-t.min,n=t.labels;if(l.scores)for(var r=0;l.scores.length>r;r++)e.push(l.scores[r]/i);else for(var r=0;n.length>r;r++){var s=l[n[r]]||l[n[r].toLowerCase().replace(" ","_")];e.push(s/i)}return e},isRunning:function(){return this._animationInstance>0},render:function(e){e||(e=this.get("config"));var t=(this.get("paper"),this.get("cx")),i=this.get("cy"),n=(this.get("r"),this.get("labels"),this.get("max"),this.get("scoreGroups")),r=this.get("options"),a=this.get("anim"),y=this,o=l.merge(f,r),c=this.getPoints();if(this.drawMeasureAndRuler(c),this.drawFrame(c),this.get("lines")){for(var p,g,u=[],_=[],m=0;n.length>m;m++){for(var b=this.getScoreFromGroup(n[m]),w=[],k=0;b.length>k;k++)p=s(t,c[k].x,b[k]),g=s(i,c[k].y,b[k]),w.push({x:p,y:g});_.push(w);var L=x(w);u.push(L)}var C=this.get("lines"),S=this.get("pts");h(u,function(l,e){var t=S[e],i=_[e];h(t,function(l){l.hide()}),y._animationInstance+=1,C[e].animate({path:u[e]},a.duration,a.easing,function(){h(t,function(l,e){l.attr({cx:i[e].x,cy:i[e].y}),l.show()}),y._animationInstance-=1})})}else{for(var A=[],m=0;n.length>m;m++){var b=this.getScoreFromGroup(n[m]),M=n[m].title;v(d,n[m].draw_options);var T=this.getGroupOption(n[m].draw_options);this.drawGroup(b,c,T),A.push({text:M,DEFAULT:T.lines.stroke})}this.drawLabels(c,o),this.drawLegend(A)}}}),o},{requires:["gallery/kcharts/1.2/raphael/index","./xxyy","dom","event","gallery/kcharts/1.2/legend/index"]});