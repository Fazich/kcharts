/*! kcharts - v1.2 - 2013-08-07 12:47:35 PM
* Copyright (c) 2013 数据可视化小组; Licensed  */
KISSY.add("gallery/kcharts/1.2/radar/index",function(l,t){function e(l,t,e){return l+(t-l)*e}function i(l){for(var t,e=0,i=l.length;i>e;e++){var r=l[e],n=r.x,s=r.y;e?t.push("L",n,s):t=["M",n,s]}return t.push("z"),t.join(",")}function r(e){this.set(e),this.dochk(e);var i,r=l.get(e.renderTo);if(!r)throw Error("容器不能为空");i=t(r,e.width,e.height),this.set("paper",i),this.set("config",e),this.render(e)}Math.PI;var n={text:{fill:"#222","max-chars":10,key:!0}},s={points:{fill:"#333","stroke-width":"0",size:4.5},text:{fill:"#222","text-anchor":"start"},lines:{"stroke-width":"1"}};return l.extend(r,l.Base,{dochk:function(l){var t=l.labels.length;this.set("sides",t)},drawPolygon:function(l){var t=this.get("paper"),e=i(l);return t.path(e)},drawFrame:function(l){var t=this.drawPolygon(l).attr({stroke:"#777"});this.set("framepath",t)},getOption:function(){var t=this.get("config"),e={text:{fill:"#222","max-chars":10,key:!0}};t.options;var i=l.merge(e,t.options);return i},getGroupOption:function(t){var e={points:{fill:"#333","stroke-width":"0",size:4.5},text:{fill:"#222","text-anchor":"start"},lines:{"stroke-width":"1"}};return l.merge(e,t)},drawGroup:function(l,t,i){for(var r,n,s,a,o=this.get("config"),c=o.cx,h=o.cy,d=this.get("paper"),f=[],p=[],g=0;t.length>g;g++)r=e(c,t[g].x,l[g]),n=e(h,t[g].y,l[g]),p.push({x:r,y:n});s=this.drawPolygon(p),i&&i.lines&&s.attr(i.lines);for(var u=0;l.length>u;u++)r=e(c,t[u].x,l[u]),n=e(h,t[u].y,l[u]),a=d.circle(r,n,i.points.size).attr(i.points),f.push(a)},getPoints:function(){for(var l,t,e=this.get("sides"),i=this.get("config"),r=-90,n=i.r,s=i.cx,a=i.cy,o=[],c=360/e,h=0;e>h;h++){var d=r/360*2*Math.PI;l=s+n*Math.cos(d),t=a+n*Math.sin(d),o.push({x:l,y:t}),r+=c}return o},drawSample:function(l,t,e){var i=this.get("paper"),r=this.get("config"),n=r.cx,s=r.cy,a=r.r,o=s+a,c=n-50,h=o+30+20*l,d=n,f=h;i.path("M "+c+" "+h+" L "+d+" "+f).attr(e.lines),i.circle(c,h,e.points.size).attr(e.points),i.text(d+10,f,t).attr(e.text)},drawLabels:function(t,i){for(var r,n,s=t,a=this.get("paper"),o=this.get("config"),c=o.cx,h=o.cy,d=(o.r,o.labels),f=0;s.length>f;f++){r=e(c,s[f].x,1.1),n=e(h,s[f].y,1.1);var p="middle";r>c&&(p="start"),c>r&&(p="end");var g=d[f];g.length>i.text["max-chars"]&&(g=g.replace(" ","\n")),a.text(r,n,g).attr(l.merge(i.text,{"text-anchor":p}))}},drawMeasureAndRuler:function(l){for(var t,i,r,n,s,a,o=this.get("paper"),c=this.get("config"),h=c.cx,d=c.cy,f=[],p=[],g=0;l.length>g;g++){t=l[g].x,i=l[g].y,f.push(o.path("M "+h+" "+d+" L "+t+" "+i).attr("stroke","#777")),p.push([]);for(var u=.025,x=1;5>x;x++){r=e(h,l[g].x,.2*x-u),n=e(d,l[g].y,.2*x-u),s=e(h,l[g].x,.2*x+u),a=e(d,l[g].y,.2*x+u);var v=o.path("M "+r+" "+n+" L "+s+" "+a).attr({stroke:"#777"});v.rotate(90)}}},getScoreFromGroup:function(l){var t=[],e=this.get("config"),i=e.max,r=e.labels;if(l.scores)for(var n=0;l.scores.length>n;n++)t.push(l.scores[n]/i);else for(var n=0;r.length>n;n++){var s=l[r[n]]||l[r[n].toLowerCase().replace(" ","_")];t.push(s/i)}return t},render:function(t){t||(t=this.get("config"));var e=(this.get("paper"),t.cx,t.cy,t.r,t.labels,t.max,t.scoreGroups),i=t.options,r=l.merge(n,i),a=this.getPoints();this.drawMeasureAndRuler(a),this.drawFrame(a);for(var o=0;e.length>o;o++){l.merge(s,e[o].draw_options);var c=this.getScoreFromGroup(e[o]),h=e[o].title,d=this.getGroupOption(e[o].draw_options);this.drawGroup(c,a,d),this.drawSample(o,h,d)}this.drawLabels(a,r)}}),r},{requires:["gallery/kcharts/1.1/raphael/index"]});