/*! kcharts - v1.2 - 2013-09-18 11:39:26 AM
* Copyright (c) 2013 数据可视化小组; Licensed  */
KISSY.add("gallery/kcharts/1.2/radar/index",function(l,t,e,i,n){function r(l,t,e){return l+(t-l)*e}function s(l){for(var t,e=0,i=l.length;i>e;e++){var n=l[e],r=n.x,s=n.y;e?t.push("L",r,s):t=["M",r,s]}return t.push("Z"),t.join(",")}function a(l,t){var e;e=t?"show":"hide",c(l,function(l){l[e]()})}function o(e){var i=l.get(e.renderTo);e.anim=l.merge(p,e.anim),this.set("container",i),this.set(e),this._animationInstance=0,this.dochk(e);var n;if(!i)throw Error("容器不能为空");n=t(i,e.width,e.height),this.set("paper",n),this.set("config",e),this.render(e)}Math.PI;var c=l.each,h=(l.map,l.filter,l.merge),d={text:{fill:"#222","max-chars":10,key:!0}},f={points:{fill:"#333","stroke-width":"0",size:4.5},text:{fill:"#222","text-anchor":"start"},lines:{"stroke-width":"1"}},p={easing:"linear",duration:800};return l.extend(o,l.Base,{dochk:function(l){var t=l.labels.length,i=e.width(this.get("container")),n=e.height(this.get("container"));this.set("sides",t),void 0==l.cx&&(l.cx=i/2),void 0==l.cy&&(l.cy=n/2);var r=this.get("scoreGroups");if(r[0]&&r[0].scores){var s=[];c(r,function(l){s=s.concat(l.scores)});var a=Math.max.apply(Math,s);l.max=a}if(void 0==l.r){var o=Math.min.apply(Math,[i,n]);l.r=o/2-30,0>l.r&&(l.r=o/2)}},drawPolygon:function(l){var t=this.get("paper"),e=s(l);return t.path(e)},drawFrame:function(l){var t=this.drawPolygon(l).attr({stroke:"#777"});this.set("framepath",t)},getOption:function(){var l=this.get("config"),t={text:{fill:"#222","max-chars":10,key:!0}};l.options;var e=h(t,l.options);return e},getGroupOption:function(t){var e={points:{fill:"#333","stroke-width":"0",size:4.5},text:{fill:"#222","text-anchor":"start"},lines:{"stroke-width":"1"}};return l.merge(e,t)},drawGroup:function(l,t,e){for(var i,n,s,a,o=this.get("config"),c=o.cx,h=o.cy,d=this.get("paper"),f=this.get("lines")||[],p=[],g=this.get("pts")||[],u=[],x=0;t.length>x;x++)i=r(c,t[x].x,l[x]),n=r(h,t[x].y,l[x]),u.push({x:i,y:n});s=this.drawPolygon(u),e&&e.lines&&s.attr(e.lines);for(var v=0;l.length>v;v++)i=r(c,t[v].x,l[v]),n=r(h,t[v].y,l[v]),a=d.circle(i,n,e.points.size).attr(e.points),p.push(a);g.push(p),f.push(s),this.get("lines")||(this.set("lines",f),this.set("pts",g))},getPoints:function(){for(var l,t,e=this.get("sides"),i=this.get("config"),n=-90,r=i.r,s=i.cx,a=i.cy,o=[],c=360/e,h=0;e>h;h++){var d=n/360*2*Math.PI;l=s+r*Math.cos(d),t=a+r*Math.sin(d),o.push({x:l,y:t}),n+=c}return o},getBBox:function(){var l=this.get("r"),t=2*l,e=2*l,i=this.get("cx"),n=this.get("cy");return{width:t,height:e,left:i-t/2,top:n-e/2}},drawLegend:function(l){var t=this.get("container"),e=this.getBBox(),i=this.get("legend")||{},r=h({interval:20,iconright:5,showicon:!0},i.globalConfig);delete i.globalConfig;var s=new n(h({container:t,paper:this.get("paper"),bbox:e,align:i.align||"bc",offset:i.offset||[0,20],globalConfig:r,config:l},i));s.on("click",function(l){if(!this.isRunning()){var t=l.index,e=(l.text,l.icon,l.el);1!=e.hide?(this.hideLine(t),e.hide=1,e.disable()):(this.showLine(t),e.hide=0,e.enable())}},this),this.set("legend",s)},hideLine:function(l){var t=this.get("lines"),e=this.get("pts");t[l]&&a([t[l]]),e[l]&&a(e[l])},showLine:function(l){var t=this.get("lines"),e=this.get("pts");t[l]&&a([t[l]],!0),e[l]&&a(e[l],!0)},drawLabels:function(t,e){for(var i,n,s=t,a=this.get("paper"),o=this.get("config"),c=o.cx,h=o.cy,d=(o.r,o.labels),f=0;s.length>f;f++){i=r(c,s[f].x,1.1),n=r(h,s[f].y,1.1);var p="middle";i>c&&(p="start"),c>i&&(p="end");var g=d[f];g.length>e.text["max-chars"]&&(g=g.replace(" ","\n")),a.text(i,n,g).attr(l.merge(e.text,{"text-anchor":p}))}},drawMeasureAndRuler:function(l){for(var t,e,i,n,s,a,o=this.get("paper"),c=this.get("config"),h=c.cx,d=c.cy,f=[],p=[],g=0;l.length>g;g++){t=l[g].x,e=l[g].y,f.push(o.path("M "+h+" "+d+" L "+t+" "+e).attr("stroke","#777"));for(var u=.025,x=1;5>x;x++){i=r(h,l[g].x,.2*x-u),n=r(d,l[g].y,.2*x-u),s=r(h,l[g].x,.2*x+u),a=r(d,l[g].y,.2*x+u);var v=o.path("M "+i+" "+n+" L "+s+" "+a).attr({stroke:"#777"});v.rotate(90),p.push(v)}}},getScoreFromGroup:function(l){var t=[],e=this.get("config"),i=e.max,n=e.labels;if(l.scores)for(var r=0;l.scores.length>r;r++)t.push(l.scores[r]/i);else for(var r=0;n.length>r;r++){var s=l[n[r]]||l[n[r].toLowerCase().replace(" ","_")];t.push(s/i)}return t},isRunning:function(){return this._animationInstance>0},render:function(t){t||(t=this.get("config"));var e=(this.get("paper"),this.get("cx")),i=this.get("cy"),n=(this.get("r"),this.get("labels"),this.get("max"),this.get("scoreGroups")),a=this.get("options"),o=this.get("anim"),p=this,g=l.merge(d,a),u=this.getPoints();if(this.drawMeasureAndRuler(u),this.drawFrame(u),this.get("lines")){for(var x,v,_=[],y=[],m=0;n.length>m;m++){for(var w=this.getScoreFromGroup(n[m]),b=[],k=0;w.length>k;k++)x=r(e,u[k].x,w[k]),v=r(i,u[k].y,w[k]),b.push({x:x,y:v});y.push(b);var L=s(b);_.push(L)}var C=this.get("lines"),A=this.get("pts");c(_,function(l,t){var e=A[t],i=y[t];c(e,function(l){l.hide()}),p._animationInstance+=1,C[t].animate({path:_[t]},o.duration,o.easing,function(){c(e,function(l,t){l.attr({cx:i[t].x,cy:i[t].y}),l.show()}),p._animationInstance-=1})})}else{for(var S=[],m=0;n.length>m;m++){var w=this.getScoreFromGroup(n[m]),E=n[m].title;h(f,n[m].draw_options);var M=this.getGroupOption(n[m].draw_options);this.drawGroup(w,u,M),S.push({text:E,DEFAULT:M.lines.stroke})}this.drawLabels(u,g),this.drawLegend(S)}}}),o},{requires:["gallery/kcharts/1.2/raphael/index","dom","event","gallery/kcharts/1.2/legend/index"]});