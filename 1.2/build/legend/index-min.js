/*! kcharts - v1.2 - 2013-08-07 12:47:35 PM
* Copyright (c) 2013 数据可视化小组; Licensed  */
KISSY.add("gallery/kcharts/1.2/legend/index",function(t,e,i,n,r){function a(i){d||(d=t.Node("<div/>").css({visibility:"hidden",position:"fixed",left:"-9999em",top:0}).appendTo(g)),e.append(i,d);var n={width:e.outerWidth(d),height:e.outerHeight(d)};return d.html(""),n}function s(t,e){var i=this.el,n=i.icon,r=i.des;"cy"===t?n.transform("t0,"+e):"top"===t&&r.css("top",e+"px")}function o(t,e){var i=this.el,n=i.icon,r=i.des;"cx"===t?n.transform("t"+e+",0"):"left"===t&&r.css(t,e+"px")}function l(e){var i=e.get("disablestyle"),n={icon:{stroke:"#ccc",fill:"#eee"},text:{color:"#ccc"}};n=t.isFunction(i)?t.mix(n,i(this,this.index)):t.mix(n,i);var r=this.icon,a=this.des;r.attr(n.icon),a.css(n.text)}function c(e,i){var n=e.get("enablestyle"),r={icon:{stroke:"#333",fill:i.DEFAULT},text:{color:i.DEFAULT}};r=t.isFunction(n)?t.mix(r,n(this,this.index)):t.mix(r,n);var a=this.icon,s=this.des;a.attr(r.icon),s.css(r.text)}function h(e){e=t.merge(u,e),this.set(e),this.init()}var d,f=window,p=f.Raphael,g=t.one(document.body),u={offset:[0,0],globalConfig:{interval:5}};return t.extend(h,t.Base,{init:function(){this._setupPaper(),this._setupCon();var e=(this.get("bbox"),this.get("paper"),this.get("align")),i=this.get("iconfn");i&&t.isFunction(i)&&(this.icon=i),this.align(e)},_setupPaper:function(){var t=this.get("paper");if(!t){var i=this.get("container");t=p(i[0],e.width(i),e.height(i)),this.set("paper",t)}"VML"==p.type||(t.canvas.style.zIndex=10)},bindEvent:function(){var e=this.get("els"),i=this;t.each(e,function(e){var n=e.icon,r=e.des,a={icon:n,text:r,index:e.index,el:e};t.each(["click","mouseover","mouseout"],function(t){n[t](function(){i.fire(t,a)}),r.on(t,function(){i.fire(t,a)})})})},onframeend:function(){this.bindEvent()},_setupCon:function(){var t=this.get("container"),i=e.css(t,"position");"static"==i&&e.css(t,"position","relative")},item:function(t){var e=this.get("els");return e[t]},icon:function(t,e,i,r){var a,s=this.get("paper");switch(r){case"triangle":i||(i=5),a=n.triangle(s,t,e+1,i);break;case"rhomb":i||(i=[8,8]),a=n.rhomb(s,t,e,i[0],i[1]);break;case"square":i||(i=8),a=n.rhomb(s,t,e,i,i,45);break;default:i||(i=5),a=s.circle(t,e,i)}return a},align:function(t){var e={tl:"alignTopLeft",tc:"alignTopCenter",tr:"alignTopRight",rt:"alignRightTop",rm:"alignRightMiddle",rb:"alignRightBottom",bl:"alignBottomLeft",bc:"alignBottomCenter",br:"alignBottomRight",lt:"alignLeftTop",lm:"alignLeftMiddle",lb:"alignLeftBottom"},i=e[t]||"alignRight";this[i]()},alignTop:function(i,n){var s=this.get("container"),h=this.get("bbox"),d=this.get("offset"),f=(this.get("paper"),this.get("config")),p=this.get("globalConfig"),g=this,u=p.iconsize||6,_=p.icontype,x=0,v=[];t.each(f,function(e){var i=t.Node('<span class="kcharts-legend-item">'+e.text+"</span>"),n=a(i);x+=n.width,v.push({el:i,width:n.width,height:n.height,zIndex:10,cursor:"pointer"})});var m=x,y=g.icon(-9999,9999,u,_),b=y.getBBox(),w=p.iconright||0,L=p.interval||0;y.remove(),m+=(b.width+w)*f.length+L*(f.length-1);var A=h.left+d[0],k=h.top+d[1]-2*u,C=A+(h.width-m)/2+u,S=k;if(n&&(S=S+4*u+h.height),"l"==i)C=0+d[0]+u;else if("r"==i){var T=e.width(s);C=T-m}var Y=[],E=this.get("alignhook"),X=this.get("iconAttrHook"),P=this.get("spanAttrHook"),I=[],G=this.get("anim"),N=G?e.width(s):0,z={icontype:_,iconsize:u,iconright:w};t.each(f,function(e,i){E&&(z=E.call(g,z,i));var n=C,r=S;n+=N;var h=g.icon(n,r,z.iconsize,z.icontype),d=h.getBBox(),f={};t.mix(f,e,!0,["DEFAULT","HOVER"]);var p={fill:f.DEFAULT};X&&(p=t.merge({fill:f.DEFAULT},X.call(g,i))),h.attr(p);var u,_,x=t.Node('<span class="kcharts-legend-item">'+e.text+"</span>"),v=a(x);u=C+z.iconsize+z.iconright,_=S-(d.height/2+(v.height-d.height)/2),u+=N;var m={left:u+"px",top:_+"px",position:"absolute",zIndex:10,cursor:"pointer"};f.DEFAULT&&(m.color=f.DEFAULT),P&&(m=t.merge(m,P.call(g,i))),x.css(m),x.appendTo(s),C+=v.width+2*z.iconsize+L+z.iconright;var y={icon:h,des:x,index:i,disable:function(){l.call(y,g,e)},enable:function(){c.call(y,g,e)}};Y.push(y),G&&I.push({el:y,frame:o,from:{cx:0,left:u},to:{cx:-N,left:u-N}})}),this.set("els",Y),G?(G.endframe=function(){g.onframeend()},r.AnimateObject(I,G)):g.onframeend()},alignTopLeft:function(){this.alignTop("l")},alignTopCenter:function(){this.alignTop("c")},alignTopRight:function(){this.alignTop("r")},alignRight:function(t){this.alignLeft(t,!0)},alignRightTop:function(){this.alignRight("t")},alignRightMiddle:function(){this.alignRight("m")},alignRightBottom:function(){this.alignRight("b")},alignBottomLeft:function(){this.alignTop("l",!0)},alignBottomCenter:function(){this.alignTop("c",!0)},alignBottomRight:function(){this.alignTop("r",!0)},alignLeft:function(i,n){var o=this.get("container"),h=this.get("bbox"),d=this.get("offset"),f=(this.get("paper"),this.get("config")),p=this.get("globalConfig"),g=this,u=p.iconsize||6,_=p.icontype,x=0,v=f[0],m=g.icon(-9999,-9999,u,_),y=m.getBBox(),b=f.length,w=p.iconright||0,L=p.interval;m.remove();var A=t.Node('<span class="kcharts-legend-item">'+v.text+"</span>"),k=a(A),C=Math.max(k.height,y.height);x+=C*b+L*(b-1);var S,T,Y,E,X=0,P=[];t.each(f,function(e){var i=t.Node('<span class="kcharts-legend-item">'+e.text+"</span>"),n=a(i);n.width>X&&(X=n.width),P.push({el:i,width:n.width,height:n.height})}),X+=w,n?(S=h.left+h.width+d[0],T=h.top+d[1],Y=S+u,E=T):(S=h.left+d[0],T=h.top+d[1],Y=S,E=T),"m"==i?E=h.top+(h.height-x)/2:"b"==i&&(E=h.top+h.height-x);var I=[],G=this.get("alignhook"),N=this.get("iconAttrHook"),z=this.get("spanAttrHook"),F=[],R=this.get("anim"),D=R?e.height(o):0,M={icontype:_,iconsize:u,iconright:w};t.each(f,function(e,i){G&&(M=G.call(g,M,i));var r,a;n?(r=Y+d[0],a=E+d[1]):(r=Y-X-u+d[0],a=E+d[1]),a+=D;var h=g.icon(r,a,M.iconsize,M.icontype),f=h.getBBox(),p=P[i],_={};t.mix(_,e,!0,["DEFAULT","HOVER"]);var x={fill:_.DEFAULT};N&&(x=t.merge(x,N.call(g,i))),h.attr(x);var v,m,y=p.el;n?(v=Y+M.iconsize+f.width+d[0],m=E-(f.height/2+(k.height-f.height)/2)+d[1]):(v=Y+d[0]-X+M.iconright,m=E-(f.height/2+(p.height-f.height)/2)+d[1]),m+=D;var b={left:v+"px",top:m+"px",position:"absolute",zIndex:10,cursor:"pointer"};_.DEFAULT&&(b.color=_.DEFAULT),z&&(b=t.merge(b,z.call(g,i))),y.css(b),y.appendTo(o);var w=Math.max(p.height,f.height);E+=w+L;var A={icon:h,des:y,index:i,disable:function(){l.call(A,g,e)},enable:function(){c.call(A,g,e)}};I.push(A),R&&F.push({el:A,frame:s,from:{cy:0,top:m},to:{cy:-D,top:m-D}})}),this.set("els",I),R?(R.endframe=function(){g.onframeend()},r.AnimateObject(F,R)):g.onframeend()},alignLeftTop:function(){this.alignLeft("t")},alignLeftMiddle:function(){this.alignLeft("m")},alignLeftBottom:function(){this.alignLeft("b")}}),h},{requires:["dom","event","gallery/kcharts/1.2/tools/graphtool/index","gallery/kcharts/1.2/animate/index"]});