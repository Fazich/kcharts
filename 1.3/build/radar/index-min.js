/*! kcharts - v1.3 - 2014-01-06 9:55:15 AM
* Copyright (c) 2014 数据可视化小组; Licensed  */
KISSY.add("gallery/kcharts/1.3/radar/index",function(l,e,t,i,n,r){function s(l,e,t){return l+(e-l)*t}function a(l){for(var e,t=0,i=l.length;i>t;t++){var n=l[t],r=n.x,s=n.y;t?e.push("L",r,s):e=["M",r,s]}return e.push("Z"),e.join(",")}function x(l,e){var t;t=e?"show":"hide",o(l,function(l){l[t]()})}Math.PI;var y,o=l.each,c=(l.map,l.filter,l.merge),h={text:{fill:"#222","max-chars":10,key:!0}},v={points:{fill:"#333","stroke-width":"0",size:4.5},text:{fill:"#222","text-anchor":"start"},lines:{"stroke-width":"1"}},f={easing:"linear",duration:800},d={initializer:function(e){e||(e=this.userConfig);var i=l.get(e.renderTo);e.anim=l.merge(f,e.anim),this.set("container",i),this.set(e),this._animationInstance=0,this.dochk(e);var n;if(!i)throw Error("容器不能为空");n=t(i,e.width,e.height),this.set("paper",n),this.set("config",e),this.render(e)},dochk:function(l){var e=l.labels.length,t=i.width(this.get("container")),n=i.height(this.get("container"));this.set("sides",e),void 0==l.cx&&(l.cx=t/2),void 0==l.cy&&(l.cy=n/2);var r=this.get("scoreGroups");if(r[0]&&r[0].scores){var s=[];o(r,function(l){s=s.concat(l.scores)});var a=Math.max.apply(Math,s);l.max=a}if(void 0==l.r){var x=Math.min.apply(Math,[t,n]);l.r=x/2-30,0>l.r&&(l.r=x/2)}},drawPolygon:function(l){var e=this.get("paper"),t=a(l);return e.path(t)},drawFrame:function(l){var e=this.drawPolygon(l).attr({stroke:"#777"});this.set("framepath",e)},getOption:function(){var l=this.get("config"),e={text:{fill:"#222","max-chars":10,key:!0}};l.options;var t=c(e,l.options);return t},getGroupOption:function(e){var t={points:{fill:"#333","stroke-width":"0",size:4.5},text:{fill:"#222","text-anchor":"start"},lines:{"stroke-width":"1"}};return l.merge(t,e)},drawGroup:function(l,e,t){for(var i,n,r,a,x=this.get("config"),y=x.cx,o=x.cy,c=this.get("paper"),h=this.get("lines")||[],v=[],f=this.get("pts")||[],d=[],g=0;e.length>g;g++)i=s(y,e[g].x,l[g]),n=s(o,e[g].y,l[g]),d.push({x:i,y:n});r=this.drawPolygon(d),t&&t.lines&&r.attr(t.lines);for(var p=0;l.length>p;p++)i=s(y,e[p].x,l[p]),n=s(o,e[p].y,l[p]),a=c.circle(i,n,t.points.size).attr(t.points),v.push(a);f.push(v),h.push(r),this.get("lines")||(this.set("lines",h),this.set("pts",f))},getPoints:function(){for(var l,e,t=this.get("sides"),i=this.get("config"),n=-90,r=i.r,s=i.cx,a=i.cy,x=[],y=360/t,o=0;t>o;o++){var c=n/360*2*Math.PI;l=s+r*Math.cos(c),e=a+r*Math.sin(c),x.push({x:l,y:e}),n+=y}return x},getBBox:function(){var l=this.get("r"),e=2*l,t=2*l,i=this.get("cx"),n=this.get("cy");return{width:e,height:t,left:i-e/2,top:n-t/2}},drawLegend:function(l){var e=this.get("container"),t=this.getBBox(),i=this.get("legend")||{},n=c({interval:20,iconright:5,showicon:!0},i.globalConfig);delete i.globalConfig;var s=new r(c({container:e,paper:this.get("paper"),bbox:t,align:i.align||"bc",offset:i.offset||[0,20],globalConfig:n,config:l},i));s.on("click",function(l){if(!this.isRunning()){var e=l.index,t=(l.text,l.icon,l.el);1!=t.hide?(this.hideLine(e),t.hide=1,t.disable()):(this.showLine(e),t.hide=0,t.enable())}},this),this.set("legend",s)},hideLine:function(l){var e=this.get("lines"),t=this.get("pts");e[l]&&x([e[l]]),t[l]&&x(t[l])},showLine:function(l){var e=this.get("lines"),t=this.get("pts");e[l]&&x([e[l]],!0),t[l]&&x(t[l],!0)},drawLabels:function(e,t){for(var i,n,r=e,a=this.get("paper"),x=this.get("config"),y=x.cx,o=x.cy,c=(x.r,x.labels),h=0;r.length>h;h++){i=s(y,r[h].x,1.1),n=s(o,r[h].y,1.1);var v="middle";i>y&&(v="start"),y>i&&(v="end");var f=c[h];f.length>t.text["max-chars"]&&(f=f.replace(" ","\n")),a.text(i,n,f).attr(l.merge(t.text,{"text-anchor":v}))}},drawMeasureAndRuler:function(l){for(var e,t,i,n,r,a,x=this.get("paper"),y=this.get("config"),o=y.cx,c=y.cy,h=[],v=[],f=0;l.length>f;f++){e=l[f].x,t=l[f].y,h.push(x.path("M "+o+" "+c+" L "+e+" "+t).attr("stroke","#777"));for(var d=.025,g=1;5>g;g++){i=s(o,l[f].x,.2*g-d),n=s(c,l[f].y,.2*g-d),r=s(o,l[f].x,.2*g+d),a=s(c,l[f].y,.2*g+d);var p=x.path("M "+i+" "+n+" L "+r+" "+a).attr({stroke:"#777"});p.rotate(90),v.push(p)}}},getScoreFromGroup:function(l){var e=[],t=this.get("config"),i=t.max,n=t.labels;if(l.scores)for(var r=0;l.scores.length>r;r++)e.push(l.scores[r]/i);else for(var r=0;n.length>r;r++){var s=l[n[r]]||l[n[r].toLowerCase().replace(" ","_")];e.push(s/i)}return e},isRunning:function(){return this._animationInstance>0},render:function(e){e||(e=this.get("config"));var t=(this.get("paper"),this.get("cx")),i=this.get("cy"),n=(this.get("r"),this.get("labels"),this.get("max"),this.get("scoreGroups")),r=this.get("options"),x=this.get("anim"),y=this,f=l.merge(h,r),d=this.getPoints();if(this.drawMeasureAndRuler(d),this.drawFrame(d),this.get("lines")){for(var g,p,u=[],_=[],m=0;n.length>m;m++){for(var b=this.getScoreFromGroup(n[m]),w=[],k=0;b.length>k;k++)g=s(t,d[k].x,b[k]),p=s(i,d[k].y,b[k]),w.push({x:g,y:p});_.push(w);var L=a(w);u.push(L)}var C=this.get("lines"),S=this.get("pts");o(u,function(l,e){var t=S[e],i=_[e];o(t,function(l){l.hide()}),y._animationInstance+=1,C[e].animate({path:u[e]},x.duration,x.easing,function(){o(t,function(l,e){l.attr({cx:i[e].x,cy:i[e].y}),l.show()}),y._animationInstance-=1})})}else{for(var A=[],m=0;n.length>m;m++){var b=this.getScoreFromGroup(n[m]),M=n[m].title;c(v,n[m].draw_options);var T=this.getGroupOption(n[m].draw_options);this.drawGroup(b,d,T),A.push({text:M,DEFAULT:T.lines.stroke})}this.drawLabels(d,f),this.drawLegend(A)}}};return e.extend?y=e.extend(d):(y=function(l){this.set(l),this.userConfig=l,this.initializer()},l.extend(y,e,d)),y},{requires:["base","gallery/kcharts/1.3/raphael/index","dom","event","gallery/kcharts/1.3/legend/index"]});