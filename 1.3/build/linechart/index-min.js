/*! kcharts - v1.3 - 2014-01-10 6:20:53 PM
* Copyright (c) 2014 数据可视化小组; Licensed  */
KISSY.add("gallery/kcharts/1.3/linechart/theme",function(){var t="{COLOR}",e={"ks-chart-default":{title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",color:"#666"},isShow:!0},points:{attr:{stroke:"#fff",r:4,"stroke-width":1.5,fill:t},hoverAttr:{stroke:"#fff",r:5,fill:t,"stroke-width":0}},xGrids:{css:{color:"#aaa"}},yGrids:{css:{color:"#aaa"}},yAxis:{css:{color:"#000"}},xAxis:{css:{color:"#000"}},xLabels:{css:{color:"#000","font-size":"12px"}},yLabels:{css:{color:"#000","font-size":"12px"}},pointLine:{css:{color:"#aaa"}}},"ks-chart-analytiks":{title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",color:"#666"},isShow:!0},points:{attr:{type:"circle",stroke:"{COLOR}",fill:"#fff",r:4,"stroke-width":2},hoverAttr:{type:"circle",stroke:"{COLOR}",fill:"#fff",r:5,"stroke-width":2}},xGrids:{css:{color:"#eee"}},yGrids:{css:{color:"#eee"}},yAxis:{css:{color:"#ccc"}},xAxis:{css:{color:"#ccc"}},xLabels:{css:{color:"#666","font-size":"12px"}},yLabels:{css:{color:"#666","font-size":"12px"}},pointLine:{css:{color:"#ccc"}}},"ks-chart-rainbow":{title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",color:"#666"},isShow:!0},points:{attr:{type:"circle",stroke:"#fff",r:4,"stroke-width":1.5,fill:t},hoverAttr:{type:"circle",stroke:"#fff",r:5,fill:t,"stroke-width":0}},xGrids:{css:{color:"#eee"}},yGrids:{css:{color:"#eee"}},yAxis:{css:{color:"#ccc"}},xAxis:{css:{color:"#ccc"}},xLabels:{css:{color:"#666","font-size":"12px"}},yLabels:{css:{color:"#666","font-size":"12px"}},pointLine:{css:{color:"#ccc"}}}};return e}),KISSY.add("gallery/kcharts/1.3/linechart/cfg",function(){var t="ks-chart-",e=t+"default",i="{COLOR}";return{themeCls:e,autoRender:!0,comparable:!1,lineType:"straight",colors:[],title:{content:"",css:{"text-align":"center","font-size":"16px"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px"},isShow:!0},points:{isShow:!0,attr:{type:"circle",stroke:"#fff",r:4,"stroke-width":1.5,fill:i},hoverAttr:{type:"circle",stroke:"#fff",r:5,fill:i,"stroke-width":0}},xLabels:{isShow:!0,css:{color:"#666","font-size":"12px","white-space":"nowrap",position:"absolute"}},yLabels:{isShow:!0,css:{color:"#666","font-size":"12px","white-space":"nowrap",position:"absolute"}},xAxis:{isShow:!0,css:{zIndex:10}},yAxis:{isShow:!0,css:{zIndex:10},num:5},xGrids:{isShow:!0,css:{}},yGrids:{isShow:!0,css:{}},areas:{isShow:!1,attr:{fill:"90-#fff-"+i,"stroke-width":0,opacity:.5}},line:{isShow:!0,attr:{"stroke-width":"3px"},hoverAttr:{"stroke-width":"4px"}},pointLine:{isShow:!1,css:{}},legend:{isShow:!1},tip:{isShow:!0,clsName:"",template:"",css:{},offset:{x:0,y:0},boundryDetect:!0}}}),KISSY.add("gallery/kcharts/1.3/linechart/index",function(t,e,i,n,r,a,o,s,c,l,h,f,d,p,g,u,x){var _,v=t.all,m="ks-chart-",y=m+"evtlayout",b="{COLOR}",w=["circle","triangle","rhomb","square"],k={initializer:function(){this.init()},init:function(){var e=this;e._cfg||(e._cfg=t.mix({autoRender:!0},e.userConfig)),e._cfg.autoRender&&e.render()},render:function(){var e,i,n=this,r=n._cfg,a=r.themeCls;if(s.prototype.init.call(n,n._cfg),n.chartType="linechart",n._$ctnNode[0]){n._lines={},n._evtEls={},n._finished=[],n._hoverstocks={},a=n._cfg.themeCls||x.themeCls,n._cfg=t.mix(t.clone(t.mix(x,f[a],void 0,void 0,!0)),n._cfg,void 0,void 0,!0),i=n.color=new c({themeCls:a}),n._cfg.colors.length>0&&i.removeAllColors();for(var h in n._cfg.colors)i.setColor(n._cfg.colors[h]);n.__cfg=n.cloneSeriesConfig(["line","points"]),points=n._points[0],e=Math.round(points&&points[0]&&points[1]&&points[1].x-points[0].x||n.getInnerContainer().width),e&&n.set("area-width",e),n.beforeRender(),n._$ctnNode.html(""),n.paper=o(n._$ctnNode[0],r.width,r.height),n.htmlPaper=new l(n._$ctnNode,{clsName:a}),s.Common.drawTitle.call(null,this,a),s.Common.drawSubTitle.call(null,this,a),n.renderTip(),s.Common.drawGridsX.call(null,this),s.Common.drawGridsY.call(null,this),n.drawPointLine(),s.Common.drawAxisX.call(null,this),s.Common.drawAxisY.call(null,this),s.Common.drawLabelsX.call(null,this),s.Common.drawLabelsY.call(null,this),n.drawLines(function(){n.__drawHoverStocks(),n.renderEvtLayout(),n.bindEvt(),n.renderLegend(),n.afterRender(),n.fix2Resize()}),t.log(n)}},cloneSeriesConfig:function(e){var i,n=this,r={},a=t.clone(n._cfg);if(e){for(var o in e)for(var s in n._cfg.series)i=n._cfg.series[s][e[o]]?t.mix(a[e[o]],n._cfg.series[s][e[o]],void 0,void 0,!0):n._cfg[e[o]],i&&(r[e[o]]||(r[e[o]]=[]),r[e[o]][s]=i);return r}},drawLine:function(t){var e=this,i=e._points[t];if(i&&i.length){e.drawArea(t);var n=s.Common.getLinePath.call(null,e,i),r=e.paper,a=e.color.getColor(t).DEFAULT,o=e.__cfg.line[t].attr,c=r.path(n).attr(o).attr({stroke:a});return e._stocks[t].stocks=e.drawStocks(t,e.processAttr(e._cfg.points.attr,a)),e._finished.push(!0),c}},drawArea:function(t){if(this._cfg.areas.isShow){var e=this,i=e._points[t];if(i&&i.length){var n=e.getAreaPath(i),r=e.paper,a=e.color.getColor(t).DEFAULT,o=e._cfg.areas.attr;e._areas[t]={0:r.path(n).attr(e.processAttr(o,a)),attr:o,path:n}}}},getAreaPath:function(t){var e=this,i=s.Common.getLinePath.call(null,e,t),n=e.getInnerContainer(),r=[i," L",n.br.x,",",n.br.y," ",n.bl.x,",",n.bl.y," z"].join("");return r},getFirstUnEmptyPointIndex:function(t){var e=this,i=e._points[t];for(var n in i)if(!e.isEmptyPoint(i[n]))return n},animateLine:function(t,e){var i,n,r,a,c=this,l=0,h=0,f=[],d=c._cfg,p=c.color,u=c.paper,x=c._points[t],_=s.Common.getLinePath.call(null,c,x),v=o.getTotalLength(_),m=d.anim?d.anim.duration||500:500,y="easeNone",b=c.get("area-width"),w=c.__cfg.line[t].attr,k=u.path(i).attr(w).attr({stroke:p.getColor(t).DEFAULT});for(var C in c._points[t])f[C]="";return a=c.getFirstUnEmptyPointIndex(t),f[a]=c.drawStock(t,a),new g({},{},{duration:m,easing:y,frame:function(){n=arguments[1]*v,i=o.getSubpath(_,h,n),r=o.pathBBox(i),l=Math.floor(1.01*r.width/b)- -a,!f[l]&&x[l]&&(f[l]=c.drawStock(t,l));for(var e in x)l>e&&!f[e]&&(f[e]=c.drawStock(t,e));k&&k.attr({path:i})},endframe:function(){c._stocks[t].stocks=f,c._finished.push(!0),c._finished.length==d.series.length&&e&&e(),c.__drawHoverStocks(t)}}),k},__drawHoverStocks:function(){var t=this;for(var e in t._stocks)t.removeHoverStock(e),t._hoverstocks[e]=t.drawStock(e,t.getFirstUnEmptyPointIndex(e),{x:0,y:0}).attr(t._stocks[e].hoverAttr).hide()},removeHoverStock:function(t){var e=this;e._hoverstocks[t]&&e._hoverstocks[t].remove&&e._hoverstocks[t].remove(),delete e._hoverstocks[t]},drawLines:function(e){var i=this,n=i._cfg,r=w.length;i._lines={},i._stocks={};for(var a in i._points){var o,c=s.Common.getLinePath.call(null,i,i._points[a]),l=i.color.getColor(a),h=i.processAttr(i._cfg.points.attr,l.DEFAULT),f=i.processAttr(i._cfg.points.hoverAttr,l.HOVER);i._stocks[a]={points:i._points[a],color:l,attr:h,hoverAttr:f,type:"auto"==h.type?w[a%r]:h.type},o=n.anim?i.animateLine(a,e):i.drawLine(a),i._lines[a]={line:o,path:c,points:i._points[a],color:l,attr:t.mix({stroke:l.DEFAULT},i._cfg.line.attr),isShow:!0},i._finished.length==n.series.length&&e&&e()}return i._lines},processAttr:function(e,i){var n=t.clone(e);for(var r in n)n[r]&&"string"==typeof n[r]&&(n[r]=n[r].replace(b,i));return n},drawStocks:function(t){if(this._cfg.points.isShow){var e=this,i=[];for(var n in e._points[t])i.push(e.drawStock(t,n));return i}},drawStock:function(e,i,n){if(this._cfg.points.isShow||void 0!==n){var r,a=this,o=a._cfg,s=a.paper,c=a.color,l=c.getColor(e).DEFAULT,h=a.processAttr(o.points.attr,l),f=a._stocks[e].type,d=a._points[e][i],p=o.points.template,n=n||{},g=void 0!==n.x?n.x:d.x,x=void 0!==n.y?n.y:d.y;if(void 0!==g&&void 0!==x){if(t.isFunction(p))return p({paper:s,lineIndex:e,stockIndex:i,attr:h,color:l,graphTool:u,x:g,y:x});switch(f){case"triangle":r=u.triangle(s,g,x,1.4*h.r);break;case"rhomb":r=u.rhomb(s,g,x,2.4*h.r,2.4*h.r);break;case"square":r=u.rhomb(s,g,x,2.4*h.r,2.4*h.r,45);break;default:r=s.circle(g,x,h.r,h)}return r.attr(h).attr({cx:g,cy:x}),r}}},drawPointLine:function(){if(this._cfg.comparable){var t=this,e=t.htmlPaper,i=t._cfg.themeCls+"-pointline",n=t._innerContainer;return t._pointline=e.lineY(0,n.tl.y,n.height).addClass(i).css(t._cfg.pointLine.css).css({display:"none"}),t._pointline}},renderTip:function(){if(this._cfg.tip.isShow){var e=this,i=e._cfg,n=e._innerContainer,r=i.tip.boundryDetect?{x:n.tl.x,y:n.tl.y,width:n.width,height:n.height}:{},a=t.mix(i.tip,{rootNode:e._$ctnNode,clsName:i.themeCls,boundry:r},void 0,void 0,!0);return e.tip=new p(a),e.tip}},renderEvtLayout:function(){var t,e=this,i=e._innerContainer,n=(i.tl.y,e._points[0]),r=n&&n[0]&&n[1]&&n[1].x-n[0].x||i.width,a=i.height,o=e._evtEls._areas=[],s=e._evtEls._rects=[];t=e._evtEls.paper?e._evtEls.paper:e._evtEls.paper=new l(e._$ctnNode,{clsName:y,prependTo:!1,width:i.width,height:a,left:i.tl.x,top:i.tl.y,css:{"z-index":20,background:"#fff",filter:"alpha(opacity =1)","-moz-opacity":.01,"-khtml-opacity":.01,opacity:.01}});for(var c=0,h=n.length;h>c;c++)o[c]={x:n[c].x-r/2,y:i.tl.y,width:r,height:a};for(var c in e._stocks){var f=e._stocks[c],d=[],n=f.points;for(var p in n)d[p]={x:n[p].x-r/2,y:n[p].y-5,width:r,height:10};s[c]=d}},clearEvtLayout:function(){var t=this;t._evtEls._areas&&t._evtEls._areas.length&&(t._evtEls._areas=[]),t._evtEls._rects&&t._evtEls._rects.length&&(t._evtEls._rects=[])},renderLegend:function(){if(this._cfg.legend.isShow){var e=this,i=e._cfg.legend,n=i.container&&v(i.container)[0]?v(i.container):e._$ctnNode,r=e._stocks,a=e._innerContainer,o=e.color._colors,s=o.length,c=e._cfg,l=e._cfg.series,f=t.map(l,function(t,e){e%=s;var i={},n=o[e];i.text=t.text,i.DEFAULT=n.DEFAULT,i.HOVER=n.HOVER;var a=r[e].type;return i.icontype="line"+a,i.iconsize=[1,1],i}),d=t.merge({interval:20,iconright:5,showicon:!0},c.legend.globalConfig);return e.legend=new h({container:n,paper:e.paper,bbox:{width:a.width,height:a.height,left:a.x,top:a.y},align:c.legend.align||"bc",offset:c.legend.offset||[0,30],globalConfig:d,config:f}),e.legend.on("click",function(t){var e=t.index,i=(t.text,t.icon,t.el);1!=i.hide?(this.hideLine(e),i.hide=1,i.disable()):(this.showLine(e),i.hide=0,i.enable())},this),e.legend}},bindEvt:function(){var t=this,e=(t._cfg,t._evtEls);t.curStockIndex=function(){for(var e in t._stocks)if(t._stocks[e].stocks)return e}(),t.curLineIndex=t.getFirstVisibleLineIndex(),r.detach(e.paper.$paper,"mouseleave"),r.on(e.paper.$paper,"mouseleave",function(){t._lines[0].line.attr(t._lines[0].attr),t.tip&&t.tip.hide(),t._pointline&&t._pointline.hide();for(var e in t._hoverstocks)t._hoverstocks[e].hide();t.curStockIndex=void 0,t.paperLeave()}),r.detach(e.paper.$paper,"mousemove"),r.on(e.paper.$paper,"mousemove",function(e){e=t.getOffset(e),t.delegateMouseMove(e)}),r.detach(e.paper.$paper,"click"),r.on(e.paper.$paper,"click",function(e){e=t.getOffset(e),t.delegateClick(e)})},delegateClick:function(t){var e=this,i=e.getInnerContainer();for(var n in e._evtEls._rects)for(var r in e._evtEls._rects[n]){var a=e._evtEls._rects[n][r];if(e.isInSide(t.offsetX+i.x,t.offsetY+i.y,a.x,a.y,a.width,a.height))return e.stockClick(n,r),void 0}},delegateMouseMove:function(t){var e=this,i=e.getInnerContainer(),n=e.curStockIndex;for(var r in e._evtEls._areas){var a=e._evtEls._areas[r];if(e.isInSide(t.offsetX+i.x,t.offsetY+i.y,a.x,a.y,a.width,a.height)&&(void 0===n||n!=r))return e.curStockIndex=r,e.tipHandler(e.curLineIndex,e.curStockIndex),void 0}for(var r in e._evtEls._rects)for(var o in e._evtEls._rects[r]){var s=e._evtEls._rects[r][o];if(e.isInSide(t.offsetX+i.x,t.offsetY+i.y,s.x,s.y,s.width,s.height)){if(e.curLineIndex===r)return;return e.lineChangeTo(r),e.tipHandler(e.curLineIndex,e.curStockIndex),void 0}}},lineChangeTo:function(t){var e=this,i=(e._cfg,e.__cfg.line[t].hoverAttr);if(!e._isAnimating&&e._lines[t].isShow){for(var n in e._stocks)e._stocks[n].points=e._points[n];for(var n in e._lines)n!=t&&e._lines[n].line&&e._lines[n].line.attr(e.__cfg.line[n].attr);e.removeLine(t),e._lines[t].line=e.drawLine(t).attr(i),e.__drawHoverStocks(),e.curLineIndex=t}},tipHandler:function(e,i){var n=this;if(void 0!==e&&void 0!==i){var r,a=n.tip,o=n._cfg,c=o.series,l=o.tip.template,h=(a.getInstance(),n._points[e]),f=(n._stocks[e],h[i]),d=n._lines[e].color.DEFAULT;if(l&&o.tip.isShow&&void 0!==n.curStockIndex){if(n._cfg.comparable){var p={datas:{}},g=[];for(var u in n._points)if(n._stocks[u].stocks&&n._points[u][i].dataInfo){n._points[u][i].dataInfo.color=n._stocks[u].color.DEFAULT;var x=t.merge(n._points[u][i].dataInfo,c[u]);delete x.data,p.datas[u]=x}for(var u in p.datas)g.push(p.datas[u]);p.datas=s.prototype.arraySort(g,!0,"y"),r=p}else r=t.merge(n._points[e][i].dataInfo,c[e]),delete r.data;n.stockChange(e,i),n.isEmptyPoint(h[i])||(r.lineindex=e,r.pointindex=i,a.fire("setcontent",{data:r}),a.fire("move",{x:f.x,y:f.y,style:n.processAttr(o.tip.css,d)}))}}},stockChange:function(e,i){var n=this,r=n._points[e],a=n._stocks[e],o=a.stocks&&a.stocks[i];if(r&&!n.isEmptyPoint(r[i])&&n._lines[e].isShow)if(n._pointline&&n._pointline.css({left:n._pointsX[i].x}).show(),n._cfg.comparable)for(var s in n._hoverstocks){var c=n._points[s][i];n._lines[s].isShow&&n._hoverstocks[s].transform(["T",c.x,",",c.y].join("")).show()}else{var c=r[i];n._lines[e].isShow&&n._hoverstocks[e].transform(["T",c.x,",",c.y].join("")).show()}else{var l=n.getFirstNotEmptyPointsLineIndex(i);l&&n.lineChangeTo(l)}if(n._points[e][i].dataInfo&&n._lines[e].isShow){var h=t.mix({target:o,currentTarget:o,lineIndex:Math.round(e),stockIndex:Math.round(i)},a.points[i]);n.fire("stockChange",h)}},getFirstNotEmptyPointsLineIndex:function(t){var e=this;for(var i in e._points)if(!e.isEmptyPoint(e._points[i][t])&&e._lines[i].isShow)return i+"";return""},getFirstVisibleLineIndex:function(){var t=this;for(var e in t._lines)if(t._lines[e].isShow)return e},isEmptyPoint:function(t){return t&&t.dataInfo?!1:!0},removeArea:function(t){this._areas&&this._areas[t]&&(this._areas[t].remove&&this._areas[t].remove(),delete this._areas[t])},removeStock:function(t){var e=this;for(var i in e._stocks[t].stocks)e._stocks[t].stocks[i]&&e._stocks[t].stocks[i].remove();delete e._stocks[t].stocks},transformLine:function(t){var e=this,i=500,n=s.Common.getLinePath.call(null,e,e._points[t]),r=e._lines[t].path;r!=n&&""!=n&&(e._isAnimating=!0,e.__transformArea(t,i),e.__transformStock(t,i),e.__transformLine(t,{path:n},i,function(){e._isAnimating=!1}))},__transformArea:function(t,e,i){var n=this,r=n._areas[t],a=n.getAreaPath(n._points[t]);r&&(r[0]&&r[0].stop()&&r[0].animate({path:a},e,i),r.path=a)},__transformLine:function(t,e,i,n){var r=this,a=r._lines[t];a.line&&a.line.stop()&&a.line.animate(e,i,n),a.path=e.path},__transformStock:function(t,e){var i,n=this,r=n._stocks[t];for(var a in r.stocks)r.stocks[a]&&(i=r.stocks[a],i.stop().animate({transform:"T"+(r.points[a].x-r.stocks[a].attr("cx"))+","+(r.points[a].y-r.stocks[a].attr("cy"))},e))},removeLine:function(t){var e=this;e._lines[t].line.remove(),e._areas[t]&&e._areas[t][0]&&e._areas[t][0].remove&&e._areas[t][0].remove();for(var i in e._stocks)t==i&&(e.removeStock(t),e.removeArea(t),e.removeHoverStock(t)),e._stocks[i].points=e._points[i]},hideLine:function(e){var i=this;if(i._lines[e].isShow){i._lines[e].isShow=!1,e==i.curLineIndex&&(i.curLineIndex=i.getFirstVisibleLineIndex()),s.prototype.removeData.call(i,e),s.Common.animateGridsAndLabels.call(null,i),i.removeLine(e);for(var n in i._lines)n!=e&&i.transformLine(n);i.clearEvtLayout(),i.renderEvtLayout(),i.bindEvt(),t.log(i)}},showLine:function(t){var e=this;if(!e._lines[t].isShow){e._lines[t].isShow=!0,e._cfg.series[t].isShow=!0,s.prototype.recoveryData.call(e,t),s.Common.animateGridsAndLabels.call(null,e),e._lines[t].line=e.drawLine(t),e.__drawHoverStocks();for(var i in e._stocks)e._stocks[i].points=e._points[i];for(var i in e._lines)e.transformLine(i);e.clearEvtLayout(),e.renderEvtLayout(),e.bindEvt()}},fix2Resize:function(){var e=this;e._$ctnNode,e._cfg.anim="";var i=t.buffer(function(){e.render()},200);!e.__isFix2Resize&&e.on("resize",function(){e.__isFix2Resize=1,i()})},paperLeave:function(){var t=this;t.fire("paperLeave",t)},stockClick:function(e,i){var n=this,r=n._stocks[e],a=r.stocks&&r.stocks[i],o=t.mix({target:a,currentTarget:a,lineIndex:Math.round(e),stockIndex:Math.round(i)},r.points[i]);n.fire("stockClick",o)},beforeRender:function(){var t=this;t.fire("beforeRender",t)},afterRender:function(){var t=this;t.fire("afterRender",t)},getHtmlPaper:function(){return this.htmlPaper},getRaphaelPaper:function(){return this.paper},clear:function(){this._$ctnNode.html("")}};return e.extend?_=s.extend(k):(_=function(t){var e=this;e._cfg=t,e.init()},t.extend(_,s,k)),_},{requires:["base","node","dom","event","gallery/template/1.0/index","gallery/kcharts/1.3/raphael/index","gallery/kcharts/1.3/basechart/index","gallery/kcharts/1.3/tools/color/index","gallery/kcharts/1.3/tools/htmlpaper/index","gallery/kcharts/1.3/legend/index","./theme","gallery/kcharts/1.3/tools/touch/index","gallery/kcharts/1.3/tip/index","gallery/kcharts/1.3/animate/index","gallery/kcharts/1.3/tools/graphtool/index","./cfg"]});