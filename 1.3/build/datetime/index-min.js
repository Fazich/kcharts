<<<<<<< HEAD
/*! kcharts - v1.3 - 2014-01-06 9:55:15 AM
* Copyright (c) 2014 数据可视化小组; Licensed  */
KISSY.add("gallery/kcharts/1.3/datetime/theme",function(){var t="{COLOR}",e={"ks-chart-default":{lineType:"arc",anim:!1,title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",color:"#666"},isShow:!0},line:{attr:{"stroke-width":1},hoverAttr:{"stroke-width":1}},points:{attr:{stroke:"#fff",r:4,"stroke-width":1.5,fill:t}},xGrids:{isShow:!1},yGrids:{css:{color:"#eee"}},yAxis:{isShow:!1,css:{color:"#ccc"}},xAxis:{css:{color:"#ccc"}},xLabels:{css:{color:"#666","font-size":"12px"}},yLabels:{css:{color:"#666","font-size":"12px",marginLeft:-10}},pointLine:{css:{color:"#ccc"}},tip:{css:{border:"1px solid {COLOR}"},alignX:"right",css:{"border-color":"{COLOR}"},offset:{y:-10,x:-10}}}};return e}),KISSY.add("gallery/kcharts/1.3/datetime/index",function(t,i,r,n,a,s,o,c,l,d,f,h,_,p,u,g){var x,v,y=t.all,m="ks-chart-",b=m+"default",L=m+"evtlayout",C="{COLOR}",A=["circle","triangle","rhomb","square"],k={initializer:function(){this.init()},init:function(){this._cfg||(this._cfg=this.userConfig);var e,i=this;if(c.prototype.init.call(i,i._cfg),i.chartType="linechart",i._$ctnNode[0]){var r={themeCls:b,autoRender:!0,comparable:!1,lineType:"straight",colors:[],title:{content:"",css:{"text-align":"center","font-size":"16px"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px"},isShow:!0},points:{attr:{type:"circle",stroke:"#fff",r:4,"stroke-width":1.5,fill:C},hoverAttr:{type:"circle",stroke:"#fff",r:5,fill:C,"stroke-width":0}},xLabels:{isShow:!0,css:{color:"#666","font-size":"12px","white-space":"nowrap",position:"absolute"}},yLabels:{isShow:!0,css:{color:"#666","font-size":"12px","white-space":"nowrap",position:"absolute"}},xAxis:{isShow:!0,css:{zIndex:10}},yAxis:{isShow:!0,css:{zIndex:10},num:5},xGrids:{isShow:!0,css:{}},yGrids:{isShow:!0,css:{}},areas:{isShow:!0,attr:{fill:"90-#fff-"+C,"stroke-width":0,opacity:.5}},line:{isShow:!0,attr:{"stroke-width":"3px"},hoverAttr:{"stroke-width":"4px"}},pointLine:{isShow:!1,css:{}},legend:{isShow:!1},tip:{isShow:!0,clsName:"",template:"",css:{},offset:{x:0,y:0},boundryDetect:!0}};i._lines={},i._finished=[],b=i._cfg.themeCls||r.themeCls,i._cfg=t.mix(t.mix(r,h[b],_,_,!0),i._cfg,_,_,!0),i.color=x=new l({themeCls:b}),i._cfg.colors.length>0&&x.removeAllColors();for(var n in i._cfg.colors)x.setColor(i._cfg.colors[n]);i.__cfg=i.cloneSeriesConfig(["line","points"]),e=i._points[0],w=Math.round(e&&e[0]&&e[1]&&e[1].x-e[0].x||i.getInnerContainer().width),w&&i.set("area-width",w),i._cfg.autoRender&&i.render(!0)}},cloneSeriesConfig:function(e){var i,r=this,n={},a=t.clone(r._cfg);if(e){for(var s in e)for(var o in r._cfg.series)i=r._cfg.series[o][e[s]]?t.mix(a[e[s]],r._cfg.series[o][e[s]],_,_,!0):r._cfg[e[s]],i&&(n[e[s]]||(n[e[s]]=[]),n[e[s]][o]=i);return n}},drawTitle:function(){var e=this,i=e.htmlPaper,r=b+"-title",n=e._cfg,a=e._innerContainer,s=.6*a.y;n.title.isShow&&""!=n.title.content&&(e._title=i.rect(0,0,e._$ctnNode.width(),s).addClass(r).css(t.mix({"line-height":s+"px"},n.title.css)).html(n.title.content))},drawSubTitle:function(){var e=this,i=e.htmlPaper,r=b+"-subtitle",n=e._cfg,a=e._innerContainer,s=.4*a.y;n.subTitle.isShow&&""!=n.subTitle.content&&(e._subTitle=i.rect(0,.6*a.y,e._$ctnNode.width(),s).addClass(r).css(t.mix({"line-height":s+"px"},n.subTitle.css)).html(n.subTitle.content))},getRealPointsNum:function(t){var e=0;for(var i in t)t[i].x&&t[i].y&&e++;return e},getVisableLineNum:function(){for(var t=this,e=t._cfg,i=e.series.length,r=i,n=0;i>n;n++)0==e.series[n].isShow&&r--;return r},drawLine:function(t,e){var i=this,r=i._points[t];if(r&&r.length){var n=i.getLinePath(r),a=i.paper,s=i.color.getColor(t).DEFAULT,o=i.__cfg.line[t].attr,c=a.path(n).attr(o).attr({stroke:s}),l=i.getVisableLineNum();return i._finished.push(!0),i._finished.length==l&&e&&e(),c}},drawArea:function(t){var e=this;if(e._cfg.areas.isShow){var i=e._points[t];if(i&&i.length){var r=e.getAreaPath(i),n=e.paper,a=e.color.getColor(t).DEFAULT,s=e._cfg.areas.attr,o=n.path(r).attr(e.processAttr(s,a));return o}}},getFirstUnEmptyPointIndex:function(t){var e=this,i=e._points[t];for(var r in i)if(!e.isEmptyPoint(i[r]))return r},animateLine:function(e,i){var r,n,a,s,c,l=this,d=0,f=0,h=l._cfg,_=l.paper,p=l._points[e],g=(l._stocks[e].type,l.getLinePath(p)),v=o.getTotalLength(g),y=(p.length||0,l.getRealPointsNum(p),h.anim?h.anim.duration||500:500),m="easeNone",b=l.get("area-width"),w=(t.mix({stroke:x.getColor(e).DEFAULT},h.line.attr),l.__cfg.line[e].attr),L=_.path(r).attr(w).attr({stroke:x.getColor(e).DEFAULT});return c=l.getFirstUnEmptyPointIndex(e),s=l.getVisableLineNum(),new u({},{},{duration:y,easing:m,step:function(){n=arguments[1]*v,r=o.getSubpath(g,f,n),a=o.pathBBox(r),d=Math.floor(1.01*a.width/b)- -c,L&&L.attr({path:r})},end:function(){l._finished.push(!0),l._finished.length==s&&i&&i()}}),L},getLinePath:function(t){var e=this,i="",r=(e._innerContainer.bl.y,e.getRealPointsNum(t)),n=0;if(!t)return"";if(n=function(){for(var i in t)if(!e.isEmptyPoint(t[i]))return Math.round(i)}(),i+="M"+t[n].x+","+t[n].y,"arc"==e._cfg.lineType&&r>2){i+=" R";for(var a=n+1,r=t.length;r>a;a++)t[a].x&&t[a].y&&(i+=t[a].x+","+t[a].y+" ")}else for(var a=n+1,r=t.length;r>a;a++)t[a].x&&t[a].y&&(i+=" L"+t[a].x+","+t[a].y);return i},getAreaPath:function(t){var e=this,i=e.getLinePath(t),r=e.getInnerContainer(),n=[i," L",r.br.x,",",r.br.y," ",r.bl.x,",",r.bl.y," z"].join("");return n},drawLines:function(e){var i=this,r=i._cfg,n=A.length;i._lines={},i._stocks={};for(var a in i._points){var s,o,c=i.getLinePath(i._points[a]),l=x.getColor(a),d=i.processAttr(i._cfg.points.attr,l.DEFAULT),f=i.processAttr(i._cfg.points.hoverAttr,l.HOVER);i._stocks[a]={points:i._points[a],color:l,attr:d,hoverAttr:f,type:"auto"==d.type?A[a%n]:d.type},r.series[a].isShow!==!1&&(s=i._areas[a]=i.drawArea(a),o=i.drawLine(a,e)),i._lines[a]={line:o,path:c,points:i._points[a],color:l,attr:t.mix({stroke:l.DEFAULT},i._cfg.line.attr),isShow:r.series[a].isShow===!1?!1:!0}}return i._lines},processAttr:function(e,i){var r=t.clone(e);for(var n in r)r[n]&&"string"==typeof r[n]&&(r[n]=r[n].replace(C,i));return r},drawStocks:function(){var t=this;for(var e in t._stocks)t._stocks[e].stock=t.drawStock(0,0,t._stocks[e].attr).hide()},drawStock:function(t,e,i,r){var n,a=this,s=a.paper,o=a._cfg.points.attr;if(t!==_&&e!==_){switch(r){case"triangle":n=g.triangle(s,t,e,1.4*o.r);break;case"rhomb":n=g.rhomb(s,t,e,2.4*o.r,2.4*o.r);break;case"square":n=g.rhomb(s,t,e,2.4*o.r,2.4*o.r,45);break;default:n=s.circle(t,e,o.r,i)}return n.attr(o).attr(i),n}return""},drawGridsX:function(){if(this._cfg.xGrids.isShow){for(var t=this,e=t._points[0],i=function(){var t=e.length,i=[];if(t>1){var r=(e[1].x-e[0].x)/2;i.push({x:e[0].x-r});for(var n in e)i.push({x:e[n].x- -r})}return i}(),r=0,n=i.length;n>r;r++){var a=t.drawGridX(i[r]);t._gridsX.push(a)}return t._gridsX}},drawGridX:function(t,e){var i=this,r=i._innerContainer.tl.y,n=i._innerContainer.height,e=e||i._cfg.xGrids.css,a=i.htmlPaper,s=i._cfg.themeCls+"-gridsx";return a.lineY(t.x,r,n).addClass(s).css(i._cfg.xGrids.css)},drawGridY:function(t,e){var i=this,r=i._innerContainer.width,e=e||i._cfg.yGrids.css,n=i.htmlPaper,a=i._cfg.themeCls+"-gridsy";return n.lineX(t.x,t.y,r).addClass(a).css(e)},drawGridsY:function(){if(this._cfg.yGrids.isShow)for(var t=this,e=t._innerContainer.tl.x,i=t._pointsY,r=0,n=i.length;n>r;r++)t._gridsY[r]={0:t.drawGridY({x:e,y:i[r].y}),num:t.coordNum[r]}},drawAxisX:function(){if(this._cfg.xAxis.isShow){var t=this,e=t._innerContainer,i=e.bl,r=e.width,n=t.htmlPaper,a=t._cfg.themeCls+"-axisx";return t._axisX=n.lineX(i.x,i.y,r).addClass(a).css(t._cfg.xAxis.css||{}),t._axisX}},drawAxisY:function(){if(this._cfg.yAxis.isShow){var t=this,e=t._innerContainer,i=e.tl,r=e.height,n=t.htmlPaper,a=t._cfg.themeCls+"-axisy";return t._axisY=n.lineY(i.x,i.y,r).addClass(a).css(t._cfg.yAxis.css||{}),t._axisY}},drawLabelsX:function(){if(this._cfg.xLabels.isShow){var t=this,e=t._cfg.xAxis.text;for(var i in e)t._labelX[i]=t.drawLabelX(i,e[i])}},drawLabelsY:function(){if(this._cfg.yLabels.isShow){var t=this;for(var e in t._pointsY)t._labelY[e]={0:t.drawLabelY(e,t._pointsY[e].number),num:t._pointsY[e].number};return t._labelY}},drawLabelX:function(e,i){var r,n=this,a=n.htmlPaper,o=n._pointsX,c=o.length||0,l=n._cfg.themeCls+"-xlabels",d="{{data}}",f="";return c>e?(d=n._cfg.xLabels.template||d,f=t.isFunction(d)?d(e,i):s(d).render({data:i}),r=o[e],r[0]=f&&a.text(r.x,r.y,"<span class="+l+">"+f+"</span>","center").children().css(n._cfg.xLabels.css),r[0]):_},drawLabelY:function(e,i){var r=this,n=r.htmlPaper,a=r._cfg.themeCls+"-ylabels",o="{{data}}",c="";return o=r._cfg.yLabels.template||o,c=t.isFunction(o)?o(e,i):s(o).render({data:i}),c&&n.text(r._pointsY[e].x,r._pointsY[e].y,"<span class="+a+">"+c+"</span>","right","middle").children().css(r._cfg.yLabels.css)},drawPointLine:function(){var t=this,e=t.htmlPaper,i=t._cfg.themeCls+"-pointline",r=t._innerContainer;return t._pointline=e.lineY(0,r.tl.y,r.height).addClass(i).css(t._cfg.pointLine.css).css({display:"none"}),t._pointline},renderTip:function(){if(this._cfg.tip.isShow){var e=this,i=e._cfg,r=e._innerContainer,n=i.tip.boundryDetect?{x:r.tl.x,y:r.tl.y,width:r.width,height:r.height}:{},a=t.mix(i.tip,{rootNode:e._$ctnNode,clsName:i.themeCls,boundry:n},_,_,!0);return e.tip=new p(a),e.tip}},renderEvtLayout:function(){var t,e=this,i=e._innerContainer,r=(i.tl.y,e._points[0]),n=r&&r[0]&&r[1]&&r[1].x-r[0].x||i.width,a=i.height,s=e._multiple,o=e._evtEls._areas=[],c=e._evtEls._rects=[];t=e._evtEls.paper?e._evtEls.paper:e._evtEls.paper=new d(e._$ctnNode,{clsName:L,prependTo:!1,width:i.width,height:a,left:i.tl.x,top:i.tl.y,css:{"z-index":20,background:"#fff",filter:"alpha(opacity =1)","-moz-opacity":.01,"-khtml-opacity":.01,opacity:.01}});for(var l=0,f=r.length;f>l;l++)o[l]={x:r[l].x-n/2,y:i.tl.y,width:n,height:a};if(s)for(var l in e._points){var c=[],r=e._points[l];for(var h in r)c[h]={x:r[h].x-n/2,y:r[h].y-5,width:n,height:10};e._evtEls._rects[l]=c}},clearEvtLayout:function(){var t=this;t._evtEls._areas&&t._evtEls._areas.length&&(t._evtEls._areas=[]),t._evtEls._rects&&t._evtEls._rects.length&&(t._evtEls._rects=[])},renderLegend:function(){if(this._cfg.legend.isShow){var e=this,i=e._cfg.legend,r=i.container&&y(i.container)[0]?y(i.container):e._$ctnNode,n=e._innerContainer,a=e.color._colors,s=a.length,o=e._cfg,c=e._cfg.series,l=t.map(c,function(t,e){e%=s;var i={},r=a[e];return i.text=t.text,i.DEFAULT=r.DEFAULT,i.HOVER=r.HOVER,i}),d=t.merge({interval:20,iconright:5,showicon:!0},o.legend.globalConfig);return e.legend=new f({container:r,bbox:{width:n.width,height:n.height,left:n.x,top:n.y},align:o.legend.align||"bc",offset:o.legend.offset||[0,30],globalConfig:d,config:l}),e.legend.on("click",function(t){var e=t.index,i=(t.text,t.icon,t.el);1!=i.hide?(this.hideLine(e),i.hide=1,i.disable()):(this.showLine(e),i.hide=0,i.enable())},this),e.legend}},render:function(e){var i=this,r=i._cfg,n=r.themeCls;i.beforeRender(),e&&i._$ctnNode.html(""),i.paper=o(i._$ctnNode[0],r.width,r.height),i.htmlPaper=new d(i._$ctnNode,{clsName:n}),i.drawTitle(),i.drawSubTitle(),i.renderTip(),i.drawGridsX(),i.drawGridsY(),i.drawPointLine(),i.drawAxisX(),i.drawAxisY(),i.drawLabelsX(),i.drawLabelsY(),i.drawLines(),i.drawStocks(),i.renderEvtLayout(),i.bindEvt(),i.renderLegend(),i.afterRender(),i.fix2Resize(),t.log(i)},bindEvt:function(){var t=this,e=(t._cfg,t._evtEls);t.curStockIndex=function(){for(var e in t._stocks)if(t._stocks[e].stocks)return e}(),t.curLineIndex=t.getFirstVisibleLineIndex(),r.detach(e.paper.$paper,"mouseleave"),r.on(e.paper.$paper,"mouseleave",function(){t._lines[0].line.attr(t._lines[0].attr),t.tip&&t.tip.hide(),t._pointline&&t._pointline.hide();for(var e in t._stocks)t._stocks[e].stock&&t._stocks[e].stock.hide();t.curStockIndex=_,t.paperLeave()}),r.detach(e.paper.$paper,"mousemove"),r.on(e.paper.$paper,"mousemove",function(e){e=t.getOffset(e),t.delegateMouseMove(e)})},delegateMouseMove:function(t){var e=this,i=e.getInnerContainer(),r=e.curStockIndex;for(var n in e._evtEls._areas){var a=e._evtEls._areas[n];if(e.isInSide(t.offsetX+i.x,t.offsetY+i.y,a.x,a.y,a.width,a.height)&&(r===_||r!=n))return e.curStockIndex=n,e.stockHandler(e.curLineIndex,e.curStockIndex),e.tipHandler(e.curLineIndex,e.curStockIndex),_}for(var n in e._evtEls._rects)for(var s in e._evtEls._rects[n]){var o=e._evtEls._rects[n][s];if(e.isInSide(t.offsetX+i.x,t.offsetY+i.y,o.x,o.y,o.width,o.height)){if(e.curLineIndex===n)return;return e.lineChangeTo(n),e.stockHandler(e.curLineIndex,e.curStockIndex),e.tipHandler(e.curLineIndex,e.curStockIndex),_}}},stockHandler:function(t,e){var i,r,n=this;for(var a in n._stocks)r=n._stocks[a].stock,i=n._points[a][e],r&&(i.y===_||isNaN(i.y)?r.hide():r.show().attr({cx:i.x,cy:i.y}));n.stockChange(t,e)},tipHandler:function(e,i){var r=this;if(e!==_&&i!==_){var n,a=r.tip,s=r._cfg,o=s.series,l=s.tip.template,d=(a.getInstance(),r._points[e][i]),f=r._lines[e].color.DEFAULT;if(r.curStockIndex!==_&&(currentPoints=r._points[e],l&&s.tip.isShow)){if(currentPoints&&!r.isEmptyPoint(currentPoints[i])&&r._lines[e].isShow)r._pointline&&r._pointline.css({"margin-left":r._pointsX[i].x}).show();else{var h=r.getFirstNotEmptyPointsLineIndex(i);h&&r.lineChangeTo(h)}if(r._cfg.comparable){var p={datas:{}},u=[];for(var g in r._points)if(r._stocks[g].stock&&r._points[g][i].dataInfo){r._points[g][i].dataInfo.color=r._stocks[g].color.DEFAULT;var x=t.merge(r._points[g][i].dataInfo,o[g]);delete x.data,p.datas[g]=x}for(var g in p.datas)u.push(p.datas[g]);p.datas=c.prototype.arraySort(u,!0,"y"),n=p}else{var n=t.merge(r._points[e][i].dataInfo,o[e]);delete n.data}r.areaChange(i),r.isEmptyPoint(currentPoints[i])||(t.mix(n,{lineindex:e,pointindex:i}),a.fire("setcontent",{data:n}),a.fire("move",{x:d.x,y:d.y,style:r.processAttr(s.tip.css,f)}))}}},getFirstNotEmptyPointsLineIndex:function(t){var e=this;for(var i in e._points)if(!e.isEmptyPoint(e._points[i][t])&&e._lines[i].isShow)return i+"";return""},getFirstVisibleLineIndex:function(){var t=this;for(var e in t._lines)if(t._lines[e].isShow)return e},isEmptyPoint:function(t){return t&&t.dataInfo?!1:!0},deleteArea:function(t){var e=this;e._areas[t]&&e._areas[t].remove&&e._areas[t].remove()},hideLine:function(e){var i=this,r=500;if(i._lines[e].isShow){i._lines[e].isShow=!1,e==i.curLineIndex&&(i.curLineIndex=i.getFirstVisibleLineIndex()),c.prototype.removeData.call(i,e),i.animateGridsAndLabels(),i._lines[e].line.remove(),i.deleteArea(e);for(var n in i._stocks)e==n&&(i._stocks[e].stock&&i._stocks[e].stock.remove(),delete i._stocks[e].stock),i._stocks[n].points=i._points[n];for(var n in i._lines)if(n!=e){var a=i.getLinePath(i._points[n]),s=i._lines[n].path,o=i.getAreaPath(i._points[n]);s!=a&&""!=a&&(i._isAnimating=!0,i._areas[n]&&i._areas[n].stop&&i._areas[n].stop()&&i._areas[n].animate({path:o},r),i._lines[n].line&&i._lines[n].line.stop()&&i._lines[n].line.animate({path:a},r,function(){i._isAnimating=!1}),i._lines[n].path=a)}i.clearEvtLayout(),i.renderEvtLayout(),i.bindEvt(),t.log(i)}},showLine:function(t){var e=this,i=500;if(!e._lines[t].isShow){e._lines[t].isShow=!0,e._cfg.series[t].isShow=!0,c.prototype.recoveryData.call(e,t),e.animateGridsAndLabels(),e._areas[t]=e.drawArea(t),e._lines[t].line=e.drawLine(t),e._stocks[t].stock=e.drawStock(0,0,e._stocks[t].attr).hide();for(var r in e._stocks)e._stocks[r].points=e._points[r];for(var r in e._lines){var n=e.getLinePath(e._points[r]),a=e._lines[r].path,s=e.getAreaPath(e._points[r]);a!=n&&e._lines[r].line&&(e._isAnimating=!0,e._areas[r]&&e._areas[r].stop&&e._areas[r].stop()&&e._areas[r].animate({path:s},i),e._lines[r].line&&e._lines[r].line.stop().animate({path:n},i,function(){e._isAnimating=!1}),e._lines[r].path=n)}e.clearEvtLayout(),e.renderEvtLayout(),e.bindEvt()}},animateGridsAndLabels:function(){var t=this,e=t._cfg,i=e.zoomType;if("y"==i){for(var r in t._labelX)t._labelX[r]&&t._labelX[r][0]&&y(t._labelX[r][0]).remove();for(var r in t._gridsX)t._gridsX[r]&&t._gridsX[r][0]&&y(t._gridsX[r][0]).remove();t.drawLabelsX(),t.drawGridsX()}else if("x"==i){for(var r in t._labelY)t._labelY[r]&&t._labelY[r][0]&&t._labelY[r][0].remove();for(var r in t._gridsY)t._gridsY[r]&&t._gridsY[r][0]&&t._gridsY[r][0].remove();t.drawGridsY(),t.drawLabelsY()}},fix2Resize:function(){var e=this;e._$ctnNode,e._cfg.anim="";var i=t.buffer(function(){e.init()},200);!e.__isFix2Resize&&e.on("resize",function(){e.__isFix2Resize=1,i()})},lineChangeTo:function(t){var e=this,i=e._cfg,r=e.__cfg.line[t].hoverAttr;if(!e._isAnimating&&e._lines[t].isShow){for(var n in e._stocks)e._stocks[n].points=e._points[n];for(var n in e._lines)n!=t&&e._lines[n].line&&e._lines[n].line.attr(e.__cfg.line[n].attr);i.areas.isShow&&(e.deleteArea(t),e._areas[t]=e.drawArea(t)),e._lines[t].line.remove(),e._stocks[t].stock.remove&&e._stocks[t].stock.remove(),e._lines[t].line=e.drawLine(t).attr(r),e._stocks[t].stock=e.drawStock(0,0,e._stocks[t].attr).hide(),e.curLineIndex=t}},areaChange:function(t){var e=this;e.fire("areaChange",{index:t})},paperLeave:function(){var t=this;t.fire("paperLeave",t)},stockChange:function(i,r){var n=this,a=n._stocks[i],s=a&&a.stock;e=t.mix({target:s,currentTarget:s,lineIndex:Math.round(i),stockIndex:Math.round(r)},a&&a.points[r]),n.fire("stockChange",e)},beforeRender:function(){var t=this;t.fire("beforeRender",t)},afterRender:function(){var t=this;t.fire("afterRender",t)},getHtmlPaper:function(){return this.htmlPaper},getRaphaelPaper:function(){return this.paper},clear:function(){this._$ctnNode.html("")}};return a.extend?v=c.extend(k):(v=function(t){var e=this;e._cfg=t,e.init()},t.extend(v,c,k)),v},{requires:["dom","event","node","base","gallery/template/1.0/index","gallery/kcharts/1.3/raphael/index","gallery/kcharts/1.3/basechart/index","gallery/kcharts/1.3/tools/color/index","gallery/kcharts/1.3/tools/htmlpaper/index","gallery/kcharts/1.3/legend/index","./theme","gallery/kcharts/1.3/tools/touch/index","gallery/kcharts/1.3/tip/index","gallery/kcharts/1.3/animate/index","gallery/kcharts/1.3/tools/graphtool/index"]});
=======
/*! kcharts - v1.3 - 2014-01-04 9:39:16 PM
* Copyright (c) 2014 数据可视化小组; Licensed  */
KISSY.add("gallery/kcharts/1.3/datetime/theme",function(){var t="{COLOR}",e={"ks-chart-default":{lineType:"arc",anim:!1,title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",color:"#666"},isShow:!0},line:{attr:{"stroke-width":1},hoverAttr:{"stroke-width":1}},points:{attr:{stroke:"#fff",r:4,"stroke-width":1.5,fill:t}},xGrids:{isShow:!1},yGrids:{css:{color:"#eee"}},yAxis:{isShow:!1,css:{color:"#ccc"}},xAxis:{css:{color:"#ccc"}},xLabels:{css:{color:"#666","font-size":"12px"}},yLabels:{css:{color:"#666","font-size":"12px",marginLeft:-10}},pointLine:{css:{color:"#ccc"}},tip:{css:{border:"1px solid {COLOR}"},alignX:"right",css:{"border-color":"{COLOR}"},offset:{y:-10,x:-10}}}};return e}),KISSY.add("gallery/kcharts/1.3/datetime/index",function(t,r,n,i,a,s,o,c,l,d,f,h,p,u,_,g){var x,m,v=t.all,y="ks-chart-",b=y+"default",C=y+"evtlayout",k="{COLOR}",A=["circle","triangle","rhomb","square"],L={initializer:function(){this.init()},init:function(){this._cfg||(this._cfg=this.userConfig);var e,r=this;if(c.prototype.init.call(r,r._cfg),r.chartType="linechart",r._$ctnNode[0]){var n={themeCls:b,autoRender:!0,comparable:!1,lineType:"straight",colors:[],title:{content:"",css:{"text-align":"center","font-size":"16px"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px"},isShow:!0},points:{attr:{type:"circle",stroke:"#fff",r:4,"stroke-width":1.5,fill:k},hoverAttr:{type:"circle",stroke:"#fff",r:5,fill:k,"stroke-width":0}},xLabels:{isShow:!0,css:{color:"#666","font-size":"12px","white-space":"nowrap",position:"absolute"}},yLabels:{isShow:!0,css:{color:"#666","font-size":"12px","white-space":"nowrap",position:"absolute"}},xAxis:{isShow:!0,css:{zIndex:10}},yAxis:{isShow:!0,css:{zIndex:10},num:5},xGrids:{isShow:!0,css:{}},yGrids:{isShow:!0,css:{}},areas:{isShow:!0,attr:{fill:"90-#fff-"+k,"stroke-width":0,opacity:.5}},line:{isShow:!0,attr:{"stroke-width":"3px"},hoverAttr:{"stroke-width":"4px"}},pointLine:{isShow:!1,css:{}},legend:{isShow:!1},tip:{isShow:!0,clsName:"",template:"",css:{},offset:{x:0,y:0},boundryDetect:!0}};r._lines={},r._finished=[],b=r._cfg.themeCls||n.themeCls,r._cfg=t.mix(t.mix(n,h[b],p,p,!0),r._cfg,p,p,!0),r.color=x=new l({themeCls:b}),r._cfg.colors.length>0&&x.removeAllColors();for(var i in r._cfg.colors)x.setColor(r._cfg.colors[i]);r.__cfg=r.cloneSeriesConfig(["line","points"]),e=r._points[0],w=Math.round(e&&e[0]&&e[1]&&e[1].x-e[0].x||r.getInnerContainer().width),w&&r.set("area-width",w),r._cfg.autoRender&&r.render(!0)}},cloneSeriesConfig:function(e){var r,n=this,i={},a=t.clone(n._cfg);if(e){for(var s in e)for(var o in n._cfg.series)r=n._cfg.series[o][e[s]]?t.mix(a[e[s]],n._cfg.series[o][e[s]],p,p,!0):n._cfg[e[s]],r&&(i[e[s]]||(i[e[s]]=[]),i[e[s]][o]=r);return i}},getRealPointsNum:function(t){var e=0;for(var r in t)t[r].x&&t[r].y&&e++;return e},getVisableLineNum:function(){for(var t=this,e=t._cfg,r=e.series.length,n=r,i=0;r>i;i++)0==e.series[i].isShow&&n--;return n},drawLine:function(t,e){var r=this,n=r._points[t];if(n&&n.length){var i=c.Common.getLinePath.call(null,r,n),a=r.paper,s=r.color.getColor(t).DEFAULT,o=r.__cfg.line[t].attr,l=a.path(i).attr(o).attr({stroke:s}),d=r.getVisableLineNum();return r._finished.push(!0),r._finished.length==d&&e&&e(),l}},drawArea:function(t){var e=this;if(e._cfg.areas.isShow){var r=e._points[t];if(r&&r.length){var n=e.getAreaPath(r),i=e.paper,a=e.color.getColor(t).DEFAULT,s=e._cfg.areas.attr,o=i.path(n).attr(e.processAttr(s,a));return o}}},getFirstUnEmptyPointIndex:function(t){var e=this,r=e._points[t];for(var n in r)if(!e.isEmptyPoint(r[n]))return n},animateLine:function(e,r){var n,i,a,s,l,d=this,f=0,h=0,p=d._cfg,u=d.paper,g=d._points[e],m=(d._stocks[e].type,c.Common.getLinePath.call(null,d,g)),v=o.getTotalLength(m),y=(g.length||0,d.getRealPointsNum(g),p.anim?p.anim.duration||500:500),b="easeNone",w=d.get("area-width"),C=(t.mix({stroke:x.getColor(e).DEFAULT},p.line.attr),d.__cfg.line[e].attr),k=u.path(n).attr(C).attr({stroke:x.getColor(e).DEFAULT});return l=d.getFirstUnEmptyPointIndex(e),s=d.getVisableLineNum(),new _({},{},{duration:y,easing:b,step:function(){i=arguments[1]*v,n=o.getSubpath(m,h,i),a=o.pathBBox(n),f=Math.floor(1.01*a.width/w)- -l,k&&k.attr({path:n})},end:function(){d._finished.push(!0),d._finished.length==s&&r&&r()}}),k},getAreaPath:function(t){var e=this,r=c.Common.getLinePath.call(null,e,t),n=e.getInnerContainer(),i=[r," L",n.br.x,",",n.br.y," ",n.bl.x,",",n.bl.y," z"].join("");return i},drawLines:function(e){var r=this,n=r._cfg,i=A.length;r._lines={},r._stocks={};for(var a in r._points){var s,o,l=c.Common.getLinePath.call(null,r,r._points[a]),d=x.getColor(a),f=r.processAttr(r._cfg.points.attr,d.DEFAULT),h=r.processAttr(r._cfg.points.hoverAttr,d.HOVER);r._stocks[a]={points:r._points[a],color:d,attr:f,hoverAttr:h,type:"auto"==f.type?A[a%i]:f.type},n.series[a].isShow!==!1&&(s=r._areas[a]=r.drawArea(a),o=r.drawLine(a,e)),r._lines[a]={line:o,path:l,points:r._points[a],color:d,attr:t.mix({stroke:d.DEFAULT},r._cfg.line.attr),isShow:n.series[a].isShow===!1?!1:!0}}return r._lines},processAttr:function(e,r){var n=t.clone(e);for(var i in n)n[i]&&"string"==typeof n[i]&&(n[i]=n[i].replace(k,r));return n},drawStocks:function(){var t=this;for(var e in t._stocks)t._stocks[e].stock=t.drawStock(0,0,t._stocks[e].attr).hide()},drawStock:function(t,e,r,n){var i,a=this,s=a.paper,o=a._cfg.points.attr;if(t!==p&&e!==p){switch(n){case"triangle":i=g.triangle(s,t,e,1.4*o.r);break;case"rhomb":i=g.rhomb(s,t,e,2.4*o.r,2.4*o.r);break;case"square":i=g.rhomb(s,t,e,2.4*o.r,2.4*o.r,45);break;default:i=s.circle(t,e,o.r,r)}return i.attr(o).attr(r),i}return""},drawPointLine:function(){var t=this,e=t.htmlPaper,r=t._cfg.themeCls+"-pointline",n=t._innerContainer;return t._pointline=e.lineY(0,n.tl.y,n.height).addClass(r).css(t._cfg.pointLine.css).css({display:"none"}),t._pointline},renderTip:function(){if(this._cfg.tip.isShow){var e=this,r=e._cfg,n=e._innerContainer,i=r.tip.boundryDetect?{x:n.tl.x,y:n.tl.y,width:n.width,height:n.height}:{},a=t.mix(r.tip,{rootNode:e._$ctnNode,clsName:r.themeCls,boundry:i},p,p,!0);return e.tip=new u(a),e.tip}},renderEvtLayout:function(){var t,e=this,r=e._innerContainer,n=(r.tl.y,e._points[0]),i=n&&n[0]&&n[1]&&n[1].x-n[0].x||r.width,a=r.height,s=e._multiple,o=e._evtEls._areas=[],c=e._evtEls._rects=[];t=e._evtEls.paper?e._evtEls.paper:e._evtEls.paper=new d(e._$ctnNode,{clsName:C,prependTo:!1,width:r.width,height:a,left:r.tl.x,top:r.tl.y,css:{"z-index":20,background:"#fff",filter:"alpha(opacity =1)","-moz-opacity":.01,"-khtml-opacity":.01,opacity:.01}});for(var l=0,f=n.length;f>l;l++)o[l]={x:n[l].x-i/2,y:r.tl.y,width:i,height:a};if(s)for(var l in e._points){var c=[],n=e._points[l];for(var h in n)c[h]={x:n[h].x-i/2,y:n[h].y-5,width:i,height:10};e._evtEls._rects[l]=c}},clearEvtLayout:function(){var t=this;t._evtEls._areas&&t._evtEls._areas.length&&(t._evtEls._areas=[]),t._evtEls._rects&&t._evtEls._rects.length&&(t._evtEls._rects=[])},renderLegend:function(){if(this._cfg.legend.isShow){var e=this,r=e._cfg.legend,n=r.container&&v(r.container)[0]?v(r.container):e._$ctnNode,i=e._innerContainer,a=e.color._colors,s=a.length,o=e._cfg,c=e._cfg.series,l=t.map(c,function(t,e){e%=s;var r={},n=a[e];return r.text=t.text,r.DEFAULT=n.DEFAULT,r.HOVER=n.HOVER,r}),d=t.merge({interval:20,iconright:5,showicon:!0},o.legend.globalConfig);return e.legend=new f({container:n,bbox:{width:i.width,height:i.height,left:i.x,top:i.y},align:o.legend.align||"bc",offset:o.legend.offset||[0,30],globalConfig:d,config:l}),e.legend.on("click",function(t){var e=t.index,r=(t.text,t.icon,t.el);1!=r.hide?(this.hideLine(e),r.hide=1,r.disable()):(this.showLine(e),r.hide=0,r.enable())},this),e.legend}},render:function(e){var r=this,n=r._cfg,i=n.themeCls;r.beforeRender(),e&&r._$ctnNode.html(""),r.paper=o(r._$ctnNode[0],n.width,n.height),r.htmlPaper=new d(r._$ctnNode,{clsName:i}),r.renderTip(),c.Common.drawTitle.call(null,this,i),c.Common.drawSubTitle.call(null,this,i),c.Common.drawGridsX.call(null,this),c.Common.drawGridsY.call(null,this),r.drawPointLine(),c.Common.drawAxisX.call(null,this),c.Common.drawAxisY.call(null,this),c.Common.drawLabelsX.call(null,this),c.Common.drawLabelsY.call(null,this),r.drawLines(),r.drawStocks(),r.renderEvtLayout(),r.bindEvt(),r.renderLegend(),r.afterRender(),r.fix2Resize(),t.log(r)},bindEvt:function(){var t=this,e=(t._cfg,t._evtEls);t.curStockIndex=function(){for(var e in t._stocks)if(t._stocks[e].stocks)return e}(),t.curLineIndex=t.getFirstVisibleLineIndex(),n.detach(e.paper.$paper,"mouseleave"),n.on(e.paper.$paper,"mouseleave",function(){t._lines[0].line.attr(t._lines[0].attr),t.tip&&t.tip.hide(),t._pointline&&t._pointline.hide();for(var e in t._stocks)t._stocks[e].stock&&t._stocks[e].stock.hide();t.curStockIndex=p,t.paperLeave()}),n.detach(e.paper.$paper,"mousemove"),n.on(e.paper.$paper,"mousemove",function(e){e=t.getOffset(e),t.delegateMouseMove(e)})},delegateMouseMove:function(t){var e=this,r=e.getInnerContainer(),n=e.curStockIndex;for(var i in e._evtEls._areas){var a=e._evtEls._areas[i];if(e.isInSide(t.offsetX+r.x,t.offsetY+r.y,a.x,a.y,a.width,a.height)&&(n===p||n!=i))return e.curStockIndex=i,e.stockHandler(e.curLineIndex,e.curStockIndex),e.tipHandler(e.curLineIndex,e.curStockIndex),p}for(var i in e._evtEls._rects)for(var s in e._evtEls._rects[i]){var o=e._evtEls._rects[i][s];if(e.isInSide(t.offsetX+r.x,t.offsetY+r.y,o.x,o.y,o.width,o.height)){if(e.curLineIndex===i)return;return e.lineChangeTo(i),e.stockHandler(e.curLineIndex,e.curStockIndex),e.tipHandler(e.curLineIndex,e.curStockIndex),p}}},stockHandler:function(t,e){var r,n,i=this;for(var a in i._stocks)n=i._stocks[a].stock,r=i._points[a][e],n&&(r.y===p||isNaN(r.y)?n.hide():n.show().attr({cx:r.x,cy:r.y}));i.stockChange(t,e)},tipHandler:function(e,r){var n=this;if(e!==p&&r!==p){var i,a=n.tip,s=n._cfg,o=s.series,l=s.tip.template,d=(a.getInstance(),n._points[e][r]),f=n._lines[e].color.DEFAULT;if(n.curStockIndex!==p&&(currentPoints=n._points[e],l&&s.tip.isShow)){if(currentPoints&&!n.isEmptyPoint(currentPoints[r])&&n._lines[e].isShow)n._pointline&&n._pointline.css({"margin-left":n._pointsX[r].x}).show();else{var h=n.getFirstNotEmptyPointsLineIndex(r);h&&n.lineChangeTo(h)}if(n._cfg.comparable){var u={datas:{}},_=[];for(var g in n._points)if(n._stocks[g].stock&&n._points[g][r].dataInfo){n._points[g][r].dataInfo.color=n._stocks[g].color.DEFAULT;var x=t.merge(n._points[g][r].dataInfo,o[g]);delete x.data,u.datas[g]=x}for(var g in u.datas)_.push(u.datas[g]);u.datas=c.prototype.arraySort(_,!0,"y"),i=u}else{var i=t.merge(n._points[e][r].dataInfo,o[e]);delete i.data}n.areaChange(r),n.isEmptyPoint(currentPoints[r])||(t.mix(i,{lineindex:e,pointindex:r}),a.fire("setcontent",{data:i}),a.fire("move",{x:d.x,y:d.y,style:n.processAttr(s.tip.css,f)}))}}},getFirstNotEmptyPointsLineIndex:function(t){var e=this;for(var r in e._points)if(!e.isEmptyPoint(e._points[r][t])&&e._lines[r].isShow)return r+"";return""},getFirstVisibleLineIndex:function(){var t=this;for(var e in t._lines)if(t._lines[e].isShow)return e},isEmptyPoint:function(t){return t&&t.dataInfo?!1:!0},deleteArea:function(t){var e=this;e._areas[t]&&e._areas[t].remove&&e._areas[t].remove()},hideLine:function(e){var r=this,n=500;if(r._lines[e].isShow){r._lines[e].isShow=!1,e==r.curLineIndex&&(r.curLineIndex=r.getFirstVisibleLineIndex()),c.prototype.removeData.call(r,e),c.Common.animateGridsAndLabels.call(null,r),r._lines[e].line.remove(),r.deleteArea(e);for(var i in r._stocks)e==i&&(r._stocks[e].stock&&r._stocks[e].stock.remove(),delete r._stocks[e].stock),r._stocks[i].points=r._points[i];for(var i in r._lines)if(i!=e){var a=c.Common.getLinePath.call(null,r,r._points[i]),s=r._lines[i].path,o=r.getAreaPath(r._points[i]);s!=a&&""!=a&&(r._isAnimating=!0,r._areas[i]&&r._areas[i].stop&&r._areas[i].stop()&&r._areas[i].animate({path:o},n),r._lines[i].line&&r._lines[i].line.stop()&&r._lines[i].line.animate({path:a},n,function(){r._isAnimating=!1}),r._lines[i].path=a)}r.clearEvtLayout(),r.renderEvtLayout(),r.bindEvt(),t.log(r)}},showLine:function(t){var e=this,r=500;if(!e._lines[t].isShow){e._lines[t].isShow=!0,e._cfg.series[t].isShow=!0,c.prototype.recoveryData.call(e,t),c.Common.animateGridsAndLabels.call(null,e),e._areas[t]=e.drawArea(t),e._lines[t].line=e.drawLine(t),e._stocks[t].stock=e.drawStock(0,0,e._stocks[t].attr).hide();for(var n in e._stocks)e._stocks[n].points=e._points[n];for(var n in e._lines){var i=c.Common.getLinePath.call(null,e,e._points[n]),a=e._lines[n].path,s=e.getAreaPath(e._points[n]);a!=i&&e._lines[n].line&&(e._isAnimating=!0,e._areas[n]&&e._areas[n].stop&&e._areas[n].stop()&&e._areas[n].animate({path:s},r),e._lines[n].line&&e._lines[n].line.stop().animate({path:i},r,function(){e._isAnimating=!1}),e._lines[n].path=i)}e.clearEvtLayout(),e.renderEvtLayout(),e.bindEvt()}},fix2Resize:function(){var e=this;e._$ctnNode,e._cfg.anim="";var r=t.buffer(function(){e.init()},200);!e.__isFix2Resize&&e.on("resize",function(){e.__isFix2Resize=1,r()})},lineChangeTo:function(t){var e=this,r=e._cfg,n=e.__cfg.line[t].hoverAttr;if(!e._isAnimating&&e._lines[t].isShow){for(var i in e._stocks)e._stocks[i].points=e._points[i];for(var i in e._lines)i!=t&&e._lines[i].line&&e._lines[i].line.attr(e.__cfg.line[i].attr);r.areas.isShow&&(e.deleteArea(t),e._areas[t]=e.drawArea(t)),e._lines[t].line.remove(),e._stocks[t].stock.remove&&e._stocks[t].stock.remove(),e._lines[t].line=e.drawLine(t).attr(n),e._stocks[t].stock=e.drawStock(0,0,e._stocks[t].attr).hide(),e.curLineIndex=t}},areaChange:function(t){var e=this;e.fire("areaChange",{index:t})},paperLeave:function(){var t=this;t.fire("paperLeave",t)},stockChange:function(r,n){var i=this,a=i._stocks[r],s=a&&a.stock;e=t.mix({target:s,currentTarget:s,lineIndex:Math.round(r),stockIndex:Math.round(n)},a&&a.points[n]),i.fire("stockChange",e)},beforeRender:function(){var t=this;t.fire("beforeRender",t)},afterRender:function(){var t=this;t.fire("afterRender",t)},getHtmlPaper:function(){return this.htmlPaper},getRaphaelPaper:function(){return this.paper},clear:function(){this._$ctnNode.html("")}};return a.extend?m=c.extend(L):(m=function(t){var e=this;e._cfg=t,e.init()},t.extend(m,c,L)),m},{requires:["dom","event","node","base","gallery/template/1.0/index","gallery/kcharts/1.3/raphael/index","gallery/kcharts/1.3/basechart/index","gallery/kcharts/1.3/tools/color/index","gallery/kcharts/1.3/tools/htmlpaper/index","gallery/kcharts/1.3/legend/index","./theme","gallery/kcharts/1.3/tools/touch/index","gallery/kcharts/1.3/tip/index","gallery/kcharts/1.3/animate/index","gallery/kcharts/1.3/tools/graphtool/index"]});
>>>>>>> 745e10f730e8ce1cd2f5c6f27c8eac4321282f32
