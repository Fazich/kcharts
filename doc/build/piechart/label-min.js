/*!build time : 2014-08-04 1:35:41 PM*/
KISSY.add("kg/kcharts/2.0.2/piechart/label",function(a,b,c,d){function e(a,b){var c,d,e,f;return c=a[0],e=a[1],d=b[0],f=b[1],Math.sqrt(Math.pow(c-d,2)+Math.pow(e-f,2))}function f(a,b,c){function d(a,f,g,h){if(c>=a.length)return{min:g,left:h};if(f>e(b,a[0])){var i=a.slice(1);return d(i,e(b,a[0]),a[0],i)}return d(a.slice(1),f,g,h)}return d(a,1/0,a[0],[])}function g(a,b){function c(a,b,d){if(0==a.length)return d;var e=f(b,a[0],a.length-1);return d.push(e.min),c(a.slice(1),e.left,d)}return c(a,b,[])}function h(a){return i||(i=b("<span/>").css({visibility:"hidden",position:"fixed",left:"-9999em",top:0}).appendTo(document.body)),i.html(a),{width:d.width(i),height:d.height(i)}}var i,j,k={initializer:function(){var a=this.get("label"),b=this.get("x"),c=this.get("y"),d=this.get("size"),e=this.get("pie"),f=(this.get("sector"),e.get("container"));a.css({position:"absolute",left:b+"px",top:c+"px",width:d.width+"px",height:d.height+"px"}).appendTo(f),this.set("el",a)},destroy:function(){var a=this.get("el"),b=this.get("$path");a.detach("click"),a.remove(),b.remove()}};c.extend?j=c.extend(k):(j=function(a){this.set(a),this.userConfig=a,this.initializer()},a.extend(j,c,k));var l,m={initializer:function(){var c,d,e,f,i,k,l,m=this.get("pie"),n=this.get("$sectors"),o=this.get("isleft"),p=m.get("paper"),q=(m.get("container"),n.length,[]),r=[],s=[],t=m.get("cx"),u=m.get("cy"),v=m.get("rs"),w=m.get("padding")||20,x=w+10,y=(Math.cos,Math.sin,Math.asin,Math.PI,Math.PI/180);if(this.labels=[],l=n[0],l&&(c=h(l.get("label")).height)){f=Math.max.apply(Math,v);var z=m.get("extraLabelHeight")||0;for(i=f+w,k=f+x,d=u-k-z,e=u+k+z,d+=c;e-c>d;d+=c){var A=d,B=(A-u)/k;-1>B?B=-1:B>1&&(B=1);var C=Math.asin(B),D=t+k*Math.cos(C);D=o?2*t-D:D,q.push([D,A])}n.length>q.length&&(n=n.sort(function(a,b){var c=Math.abs(a.get("start")-a.get("end")),d=Math.abs(b.get("start")-b.get("end"));return c>d?-1:d>c?1:0}),n=n.slice(0,q.length)),n=n.sort(function(a,b){var c=a.get("middley"),d=b.get("middley");return d>c?1:c>d?-1:0});{Math.PI/180}a.each(n,function(a){var b,c,d=a.get("middlex"),e=a.get("middley"),f=a.get("middleangle")*y;b=t+i*Math.cos(-f),c=u+i*Math.sin(-f),s.push([b,c]),r.push([d,e])}),r=r.reverse(),s=s.reverse(),n=n.reverse();for(var E=g(r,q),F=0,G=E.length;G>F;F++){var H,I,J,K,L=r[F],M=E[F];H=L[0],J=L[1],I=M[0],K=M[1];var N,O;N=s[F][0],O=s[F][1];var P,Q=K;P=o?I-10:I+10;var R,S,T,U=p.path(["M",H,J,"Q",N,O,P,Q].join(",")),V=n[F],W=m.get("sizefn"),X=V.get("label"),Y=m.get("labelfn"),Z=this,$=V.get("$path").attr("fill"),_=m.get("autoLabelPathColor");Y&&a.isFunction(Y)&&(X=Y(X,V,m)),R=h(X),U&&U.toBack&&U.toBack(),"undefined"!=_&&U.attr("stroke",$),W&&a.isFunction(W)&&(R=W(R,V,m)),o?(S=P-R.width-3,T=Q-R.height/2):(S=P+5,T=Q-R.height/2);var ab=b("<span class='kcharts-label'>"+X+"</span>"),bb=new j({label:ab,sector:V,$path:U,x:S,y:T,size:R,pie:m}),cb=bb.get("el"),db=function(a,b,c){b.$label=a,a.on("click",function(a){Z.fire("click",{el:a.currentTarget,label:c,sector:b})})};db(cb,V,bb),Z.labels.push(bb)}}},destroy:function(){a.each(this.labels,function(a){a.destroy()})}};return c.extend?l=c.extend(m):(l=function(a){this.set(a),this.userConfig=a,this.initializer()},a.extend(l,c,m)),l.getSizeOf=h,l},{requires:["node","base","dom"]});